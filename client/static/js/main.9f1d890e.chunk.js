(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{12:function(e,n,t){},21:function(e,n,t){},30:function(e,n){},31:function(e,n,t){"use strict";t.r(n);var r=t(0),c=t(1),a=t.n(c),s=t(13),o=t.n(s),u=(t(21),t(2)),i=(t(12),t(14)),l={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302"]}]};function f(e){console.log("opened chat!!"),console.log(e.messageHandlers);var n={type:"info",value:"successfully opened connection!!"};for(var t in e.messageHandlers)e.messageHandlers[t](n)}function d(e,n){console.log("received message!"),console.log(e.messageHandlers);var t=JSON.parse(n.data);for(var r in console.log(t),e.messageHandlers)e.messageHandlers[r](t)}function j(e,n){var t=e.messageHandlersIndx;return e.messageHandlers[t]=n,e.messageHandlersIndx="".concat(parseInt(t)+1),t}function b(e,n){console.log("removing key ".concat(n," from conn ").concat(e)),delete e.messageHandlers[n]}function g(e,n){e.dc.send(JSON.stringify(n))}function O(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function h(e){var n=e;return n.length%4!==0&&(n+="===".slice(0,4-n.length%4)),n=n.replace(/-/g,"+").replace(/_/g,"/"),atob(n)}var p=t(5),m=t.n(p),R=t(10),y=t(4),v=t(15),x=t.n(v);function S(e,n){for(var t,r,c=e.length;0!==c;)r=Math.floor(n()*c),t=e[c-=1],e[c]=e[r],e[r]=t;return e}var A,E=t(8),T="Q",C="K",N=["A","2","3","4","5","6","7","8","9","10","J",T,C],P=["spades","hearts","diamonds","clubs"];function k(e){return S(function(){var e,n=[],t=0,r=Object(E.a)(P);try{for(r.s();!(e=r.n()).done;){var c,a=e.value,s=0,o=Object(E.a)(N);try{for(o.s();!(c=o.n()).done;){var u=c.value;n.push({rank:u,suit:a,rank_index:s,suit_index:t}),s++}}catch(i){o.e(i)}finally{o.f()}t++}}catch(i){r.e(i)}finally{r.f()}return n}(),e)}function w(e){var n="\ud83c\udca1".charCodeAt(0),t="\ud83c\udca1".charCodeAt(1);return String.fromCharCode(n)+String.fromCharCode(t+e.rank_index+16*e.suit_index+(e.rank===T||e.rank===C?1:0))}function D(e){var n,t="",r=Object(E.a)(e);try{for(r.s();!(n=r.n()).done;){t+=w(n.value)}}catch(c){r.e(c)}finally{r.f()}return t}function Y(e,n){e||(console.error("assertion failed"),console.error(n))}var H={SETUP:"SETUP",PLAY:"PLAY",GAMEOVER:"GAMEOVER",ABORT:"ABORT"},_=(Object.values(H),{PRE_READY:"PRE_READY",SENT_READY:"SENT_READY",SENT_START:"SENT_START"}),M=(Object.values(_),{READY:"READY",START:"START",PLAY:"PLAY",PLAYACK:"PLAYACK",ABORT:"ABORT"}),I=Object.values(M),L=(A={},Object(y.a)(A,M.READY,(function(e,n){e.phase!==H.SETUP&&V(e);e.state!==_.PRE_READY&&e.state!==_.SENT_READY&&V(e);var t=n.from,r=n.hash;e.players.includes(t)&&V(e);e.players.push(t),e.readyHashes[t]=r,q(e),G(e)})),Object(y.a)(A,M.START,(function(e,n){return K.apply(this,arguments)})),Object(y.a)(A,M.PLAY,(function(e,n){F(),G(e)})),Object(y.a)(A,M.PLAYACK,(function(e,n){F(),G(e)})),Object(y.a)(A,M.ABORT,(function(e,n){console.log("ABORTING :(((( SAD"),F(),G(e)})),A);function J(e,n){var t=e.listenerIndex;return e.listeners[t]=n,e.listenerIndex="".concat(parseInt(t)+1),t}function B(e,n){console.log("removing key ".concat(n," from game ").concat(e)),delete e.listener[n]}function G(e){for(var n=0,t=Object.values(e.listeners);n<t.length;n++){(0,t[n])()}}function U(e,n){var t,r;n.from=e.userId,t=e.conn,r=n,g(t,Object(i.a)({type:"data"},r))}function F(){Y(!1,"not implemented yet!!")}function K(){return(K=Object(R.a)(m.a.mark((function e(n,t){var r,c,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.phase!==H.SETUP&&V(n,"wrong phase"),n.state!==_.SENT_READY&&n.state!==_.SENT_START&&V(n),r=t.from,c=t.randomNumber,Object.keys(n.startNumbers).includes(r)&&V(n),n.players.includes(r)||V(n,"unknown user ".concat(r)),e.next=8,z("".concat(c));case 8:a=e.sent,n.readyHashes[r]!==a&&V(n,"incorrect hash ".concat(a," received for random number ").concat(c," from user ").concat(r)),n.startNumbers[r]=c,$(n),G(n);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,n){console.error("ABORT GAME :(("),console.error(n),U(e,{method:M.ABORT,reason:n}),e.phase=H.ABORT,G(e)}function z(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(R.a)(m.a.mark((function e(n){var t,r,c,a,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new TextEncoder,r=t.encode(n),e.next=4,crypto.subtle.digest("SHA-256",r);case 4:return c=e.sent,a=Array.from(new Uint8Array(c)),s=a.map((function(e){return e.toString(16).padStart(2,"0")})).join(""),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(R.a)(m.a.mark((function e(n){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y(n.phase===H.SETUP&&n.state===_.PRE_READY||n.phase===H.GAMEOVER,n),n.myRandom=Math.floor(Math.random()*Math.pow(2,64)),e.next=4,z("".concat(n.myRandom));case 4:t=e.sent,console.log(t),n.readyHashes[n.userId]=t,U(n,{method:M.READY,hash:t}),n.state=_.SENT_READY,q(n),G(n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){e.players.length===Object.keys(e.startNumbers).length&&function(e){Y(e.phase===H.SETUP&&e.state===_.SENT_START,e);var n=0;Object.values(e.startNumbers).forEach((function(e){n^=e})),console.log("final randomness: ".concat(n));var t=x()("".concat(n));delete e.state,delete e.readyHashes,delete e.startNumbers,delete e.myRandom,e.players=S(e.players.sort(),t),e.nextTurn=e.players[0],e.playedCards=[],e.playerHands=function(e,n){var t,r=k(n),c={},a=0,s=Object(E.a)(e);try{for(s.s();!(t=s.n()).done;)c[t.value]=[]}catch(i){s.e(i)}finally{s.f()}for(;a<r.length;){var o,u=Object(E.a)(e);try{for(u.s();!(o=u.n()).done;)c[o.value].push(r[a]),a++}catch(i){u.e(i)}finally{u.f()}}return c}(S(e.players,t),t),e.phase=H.PLAY,console.log("STARTING GAME!!!! exciting :)))"),console.log(e),G(e)}(e)}function q(e){e.conn,1===Object.keys(e.readyHashes).length-1&&(Y(e.players.length===Object.keys(e.readyHashes).length,e),function(e){Y(e.phase===H.SETUP&&e.state===_.SENT_READY,e),U(e,{method:M.START,randomNumber:e.myRandom}),e.startNumbers[e.userId]=e.myRandom,e.state=_.SENT_START,$(e),G(e)}(e))}function X(e){return e.userId}function Z(e){return e.players.filter((function(n){return n!==X(e)}))[0]}function ee(e){return e.playerHands[X(e)]}function ne(e){return e.playerHands[Z(e)]}function te(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useState)(""),i=Object(u.a)(o,2),l=i[0],f=i[1];function d(){g(e.connRef.current,{type:"message",message:a}),O(a),s("")}function O(e){f((function(n){return""===n?e:e+"\n"+n}))}return Object(c.useEffect)((function(){var n=j(e.connRef.current,(function(e){if("message"===e.type)return O(e.message);O(JSON.stringify(e))}));return function(){console.log("cleaning up chat!!! index ".concat(n)),b(e.connRef.current,n)}}),[e.connRef]),Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?d():0}}),Object(r.jsx)("button",{onClick:d,children:"Send message"}),Object(r.jsx)("p",{style:{whiteSpace:"pre-line"},children:l})]})}function re(){return Object(r.jsx)("div",{children:"Waiting for everyone else to press start..."})}function ce(e){var n=Object(c.useState)(e.gameRef.current.playedCards),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useState)(ee(e.gameRef.current)),i=Object(u.a)(o,2),l=i[0],f=i[1],d=Object(c.useState)(ne(e.gameRef.current)),j=Object(u.a)(d,2),b=j[0],g=j[1],O=Object(c.useState)(X(e.gameRef.current)),h=Object(u.a)(O,2),p=h[0],m=(h[1],Object(c.useState)(Z(e.gameRef.current))),R=Object(u.a)(m,2),y=R[0],v=(R[1],Object(c.useCallback)((function(){s(e.gameRef.current.playedCards),f(ee(e.gameRef.current)),g(ne(e.gameRef.current))}),[e.gameRef]));return Object(c.useEffect)((function(){var n=J(e.gameRef.current,v);return function(){B(e.gameRef.current,n)}}),[e.gameRef,v]),Object(r.jsxs)("div",{children:["Playing the game!!!",Object(r.jsx)("hr",{}),Object(r.jsx)(se,{cards:b,user:y}),Object(r.jsx)(ae,{cards:a}),Object(r.jsx)(se,{cards:l,user:p})]})}function ae(e){return Object(r.jsxs)("div",{children:["played cards:"," ",0===e.cards.length?"(none)":D(e.cards)]})}function se(e){return Object(r.jsxs)("div",{children:[e.user,"'s cards:",Object(r.jsx)(oe,{cards:e.cards})]})}function oe(e){return Object(r.jsx)("div",{style:{fontSize:"3em"},children:0===e.cards.length?"(none)":D(e.cards)})}function ue(e){var n=Object(c.useState)(e.gameRef.current.phase),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useCallback)((function(){s(e.gameRef.current.phase)}),[e.gameRef]);return Object(c.useEffect)((function(){var n=J(e.gameRef.current,o);return function(){B(e.gameRef.current,n)}}),[e.gameRef,o]),Object(r.jsxs)("div",{children:["welcome to the game good sir!",Object(r.jsx)("hr",{}),a===H.SETUP&&Object(r.jsx)(re,{}),a===H.PLAY&&Object(r.jsx)(ce,{gameRef:e.gameRef}),Object(r.jsx)("hr",{}),Object(r.jsx)(te,{connRef:e.connRef})]})}function ie(e){return Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:function(){return n=e.connRef.current,t=e.setMyOffer,console.log("create offer"),console.log(n.pc.signalingState),n.dc=n.pc.createDataChannel("chat"),n.dc.onopen=function(){return f(n)},n.dc.onmessage=function(e){return d(n,e)},n.pc.createOffer().then((function(e){return n.pc.setLocalDescription(e)})).catch(console.log),void(n.pc.onicecandidate=function(e){e.candidate||t(O(JSON.stringify(n.pc.localDescription)))});var n,t},children:"Create game"})})}function le(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1];return Object(r.jsxs)("div",{children:["send this message to your friends: ",Object(r.jsx)("code",{children:e.offer}),Object(r.jsx)("br",{}),"input their answer:",Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)}}),Object(r.jsx)("button",{onClick:function(){return function(e,n){console.log("join"),console.log(e.pc.signalingState);var t=new RTCSessionDescription(JSON.parse(h(n)));e.pc.setRemoteDescription(t).catch(console.log)}(e.connRef.current,a)},children:"Add player"})]})}function fe(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1];return Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)}}),Object(r.jsx)("button",{onClick:function(){return function(e,n,t){console.log("join"),console.log(e.pc.signalingState);var r=new RTCSessionDescription(JSON.parse(h(n)));e.pc.setRemoteDescription(r).then((function(){return e.pc.createAnswer()})).then((function(n){return e.pc.setLocalDescription(n)})).catch(console.log),e.pc.onicecandidate=function(n){n.candidate||t(O(JSON.stringify(e.pc.localDescription)))}}(e.connRef.current,a,e.setMyAnswer)},children:"Join"})]})}function de(e){return Object(r.jsxs)("div",{children:["send this message to your friends: ",Object(r.jsx)("code",{children:e.answer}),Object(r.jsx)("br",{})]})}function je(e){return console.log(e.connRef),Object(r.jsxs)("div",{children:[Object(r.jsx)(ie,{connRef:e.connRef,setMyOffer:e.setMyOffer}),Object(r.jsx)("br",{}),Object(r.jsx)(fe,{connRef:e.connRef,setMyAnswer:e.setMyAnswer}),Object(r.jsx)("br",{})]})}function be(e){return Object(r.jsxs)("div",{children:[e.offer?Object(r.jsx)(le,{connRef:e.connRef,offer:e.offer}):Object(r.jsx)(de,{connRef:e.connRef,answer:e.answer}),Object(r.jsx)("hr",{}),"Participants list: idk",Object(r.jsx)("br",{}),Object(r.jsx)("hr",{}),Object(r.jsx)("button",{onClick:e.startGame,children:"Start game!"}),Object(r.jsx)("hr",{}),Object(r.jsx)(te,{connRef:e.connRef})]})}function ge(e){var n=Object(c.useState)(null),t=Object(u.a)(n,2),s=t[0],o=t[1],i=Object(c.useState)(null),l=Object(u.a)(i,2),f=l[0],d=l[1];return s||f?Object(r.jsx)(be,{connRef:e.connRef,offer:s,answer:f,startGame:e.startGame}):Object(r.jsx)(a.a.Fragment,{children:Object(r.jsx)(je,{connRef:e.connRef,setMyOffer:o,setMyAnswer:d})})}Y(JSON.stringify(I)===JSON.stringify(Object.keys(L)),{methods:I,handlers:L});var Oe=function(){var e=Object(c.useState)(!0),n=Object(u.a)(e,2),t=n[0],a=n[1],s=Object(c.useRef)(),o=Object(c.useRef)(),i=Object(c.useCallback)((function(){a(!1),function(e){W.apply(this,arguments)}(o.current)}),[o]);return Object(c.useEffect)((function(){s.current=function(){var e={pc:new RTCPeerConnection(l),dc:null,messageHandlers:{},messageHandlersIndx:"0"};return e.pc.ondatachannel=function(n){e.dc=n.channel,e.dc.onopen=function(){return f(e)},e.dc.onmessage=function(n){return d(e,n)}},e.pc.oniceconnectionstatechange=function(n){return console.log(e.pc.iceConnectionState)},e}(),o.current=function(e){var n=Math.random().toString(36).substr(2,9);return{conn:e,listeners:{},listenerIndex:"0",phase:H.SETUP,userId:n,state:_.PRE_READY,players:[n],readyHashes:{},startNumbers:{},myRandom:null}}(s.current)}),[]),Object(c.useEffect)((function(){var e=j(s.current,(function(e){return function(e,n){console.log("game receiving message!"),console.log(n),"data"===n.type?(Y(I.includes(n.method)),console.log(L),L[n.method](e,n)):console.log("ignoring non-data message")}(o.current,e)}));return function(){b(s.current,e)}}),[s,o]),Object(r.jsxs)("div",{className:"App",children:[t&&Object(r.jsx)(ge,{connRef:s,startGame:i}),!t&&Object(r.jsx)(ue,{connRef:s,gameRef:o})]})},he=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,32)).then((function(n){var t=n.getCLS,r=n.getFID,c=n.getFCP,a=n.getLCP,s=n.getTTFB;t(e),r(e),c(e),a(e),s(e)}))};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(Oe,{})}),document.getElementById("root")),he()}},[[31,1,2]]]);
//# sourceMappingURL=main.9f1d890e.chunk.js.map