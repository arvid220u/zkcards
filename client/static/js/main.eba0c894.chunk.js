(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{12:function(e,n,t){},21:function(e,n,t){},30:function(e,n){},31:function(e,n,t){"use strict";t.r(n);var c=t(0),r=t(1),s=t.n(r),o=t(13),a=t.n(o),i=(t(21),t(3)),u=(t(12),t(14)),l={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302"]}]};function f(e){console.log("opened chat!!"),console.log(e.messageHandlers);var n={type:"info",value:"successfully opened connection!!"};for(var t in e.messageHandlers)e.messageHandlers[t](n)}function d(e,n){console.log("received message!"),console.log(e.messageHandlers);var t=JSON.parse(n.data);for(var c in console.log(t),e.messageHandlers)e.messageHandlers[c](t)}function j(e,n){var t=e.messageHandlersIndx;return e.messageHandlers[t]=n,e.messageHandlersIndx="".concat(parseInt(t)+1),t}function b(e,n){console.log("removing key ".concat(n," from conn ").concat(e)),delete e.messageHandlers[n]}function g(e,n){e.dc.send(JSON.stringify(n))}function O(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function p(e){var n=e;return n.length%4!==0&&(n+="===".slice(0,4-n.length%4)),n=n.replace(/-/g,"+").replace(/_/g,"/"),atob(n)}var h=t(5),m=t.n(h),R=t(10),v=t(4),y=t(15),S=t.n(y);function A(e,n){for(var t,c,r=e.length;0!==r;)c=Math.floor(n()*r),t=e[r-=1],e[r]=e[c],e[c]=t;return e}var E,x=t(8),T=Object.values({ACE:"A",TWO:"2",THREE:"3",FOUR:"4",FIVE:"5",SIX:"6",SEVEN:"7",EIGHT:"8",NINE:"9",TEN:"10",JACK:"J",QUEEN:"Q",KING:"K"}),N=Object.values({SPADES:"spades",CLUBS:"clubs",DIAMONDS:"diamonds",HEARTS:"hearts"});function P(e){return A(function(){var e,n=[],t=Object(x.a)(T);try{for(t.s();!(e=t.n()).done;){var c,r=e.value,s=Object(x.a)(N);try{for(s.s();!(c=s.n()).done;){var o=c.value;n.push({rank:r,suit:o})}}catch(a){s.e(a)}finally{s.f()}}}catch(a){t.e(a)}finally{t.f()}return n}(),e)}function D(e,n){e||(console.error("assertion failed"),console.error(n))}var w={SETUP:"SETUP",PLAY:"PLAY",GAMEOVER:"GAMEOVER",ABORT:"ABORT"},C=(Object.values(w),{PRE_READY:"PRE_READY",SENT_READY:"SENT_READY",SENT_START:"SENT_START"}),Y=(Object.values(C),{READY:"READY",START:"START",PLAY:"PLAY",PLAYACK:"PLAYACK",ABORT:"ABORT"}),H=Object.values(Y),k=(E={},Object(v.a)(E,Y.READY,(function(e,n){e.phase!==w.SETUP&&J(e);e.state!==C.PRE_READY&&e.state!==C.SENT_READY&&J(e);var t=n.from,c=n.hash;e.players.includes(t)&&J(e);e.players.push(t),e.readyHashes[t]=c,K(e),I(e)})),Object(v.a)(E,Y.START,(function(e,n){return L.apply(this,arguments)})),Object(v.a)(E,Y.PLAY,(function(e,n){_(),I(e)})),Object(v.a)(E,Y.PLAYACK,(function(e,n){_(),I(e)})),Object(v.a)(E,Y.ABORT,(function(e,n){console.log("ABORTING :(((( SAD"),_(),I(e)})),E);function I(e){for(var n=0,t=Object.values(e.listeners);n<t.length;n++){(0,t[n])()}}function M(e,n){var t,c;n.from=e.userId,t=e.conn,c=n,g(t,Object(u.a)({type:"data"},c))}function _(){D(!1,"not implemented yet!!")}function L(){return(L=Object(R.a)(m.a.mark((function e(n,t){var c,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.phase!==w.SETUP&&J(n,"wrong phase"),n.state!==C.SENT_READY&&n.state!==C.SENT_START&&J(n),c=t.from,r=t.randomNumber,Object.keys(n.startNumbers).includes(c)&&J(n),n.players.includes(c)||J(n,"unknown user ".concat(c)),e.next=8,U("".concat(r));case 8:s=e.sent,n.readyHashes[c]!==s&&J(n,"incorrect hash ".concat(s," received for random number ").concat(r," from user ").concat(c)),n.startNumbers[c]=r,F(n),I(n);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,n){console.error("ABORT GAME :(("),console.error(n),M(e,{method:Y.ABORT,reason:n}),e.phase=w.ABORT,I(e)}function U(e){return G.apply(this,arguments)}function G(){return(G=Object(R.a)(m.a.mark((function e(n){var t,c,r,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new TextEncoder,c=t.encode(n),e.next=4,crypto.subtle.digest("SHA-256",c);case 4:return r=e.sent,s=Array.from(new Uint8Array(r)),o=s.map((function(e){return e.toString(16).padStart(2,"0")})).join(""),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(R.a)(m.a.mark((function e(n){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(n.phase===w.SETUP&&n.state===C.PRE_READY||n.phase===w.GAMEOVER,n),n.myRandom=Math.floor(Math.random()*Math.pow(2,64)),e.next=4,U("".concat(n.myRandom));case 4:t=e.sent,console.log(t),n.readyHashes[n.userId]=t,M(n,{method:Y.READY,hash:t}),n.state=C.SENT_READY,K(n),I(n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){e.players.length===Object.keys(e.startNumbers).length&&function(e){D(e.phase===w.SETUP&&e.state===C.SENT_START,e);var n=0;Object.values(e.startNumbers).forEach((function(e){n^=e})),console.log("final randomness: ".concat(n));var t=S()("".concat(n));delete e.state,delete e.readyHashes,delete e.startNumbers,delete e.myRandom,e.players=A(e.players.sort(),t),e.nextTurn=e.players[0],e.playedCards=[],e.playerHands=function(e,n){var t,c=P(n),r={},s=0,o=Object(x.a)(e);try{for(o.s();!(t=o.n()).done;)r[t.value]=[]}catch(u){o.e(u)}finally{o.f()}for(;s<c.length;){var a,i=Object(x.a)(e);try{for(i.s();!(a=i.n()).done;)r[a.value].push(c[s]),s++}catch(u){i.e(u)}finally{i.f()}}return r}(A(e.players,t),t),e.phase=w.PLAY,console.log("STARTING GAME!!!! exciting :)))"),console.log(e),I(e)}(e)}function K(e){e.conn,1===Object.keys(e.readyHashes).length-1&&(D(e.players.length===Object.keys(e.readyHashes).length,e),function(e){D(e.phase===w.SETUP&&e.state===C.SENT_READY,e),M(e,{method:Y.START,randomNumber:e.myRandom}),e.startNumbers[e.userId]=e.myRandom,e.state=C.SENT_START,F(e),I(e)}(e))}function V(e){var n=Object(r.useState)(""),t=Object(i.a)(n,2),s=t[0],o=t[1],a=Object(r.useState)(""),u=Object(i.a)(a,2),l=u[0],f=u[1];function d(){g(e.connRef.current,{type:"message",message:s}),O(s),o("")}function O(e){f((function(n){return""===n?e:e+"\n"+n}))}return Object(r.useEffect)((function(){var n=j(e.connRef.current,(function(e){if("message"===e.type)return O(e.message);O(JSON.stringify(e))}));return function(){console.log("cleaning up chat!!! index ".concat(n)),b(e.connRef.current,n)}}),[e.connRef]),Object(c.jsxs)("div",{children:[Object(c.jsx)("input",{type:"text",value:s,onChange:function(e){return o(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?d():0}}),Object(c.jsx)("button",{onClick:d,children:"Send message"}),Object(c.jsx)("p",{style:{whiteSpace:"pre-line"},children:l})]})}function Q(){return Object(c.jsx)("div",{children:"Waiting for everyone else to press start..."})}function W(){return Object(c.jsx)("div",{children:"Playing the game!!!"})}function X(e){var n=Object(r.useState)(e.gameRef.current.phase),t=Object(i.a)(n,2),s=t[0],o=t[1],a=Object(r.useCallback)((function(){o(e.gameRef.current.phase)}),[e.gameRef]);return Object(r.useEffect)((function(){var n=function(e,n){var t=e.listenerIndex;return e.listeners[t]=n,e.listenerIndex="".concat(parseInt(t)+1),t}(e.gameRef.current,a);return function(){var t,c;t=e.gameRef.current,c=n,console.log("removing key ".concat(c," from game ").concat(t)),delete t.listener[c]}}),[e.gameRef]),Object(c.jsxs)("div",{children:["welcome to the game good sir!",Object(c.jsx)("hr",{}),s===w.SETUP&&Object(c.jsx)(Q,{}),s===w.PLAY&&Object(c.jsx)(W,{gameRef:e.gameRef}),Object(c.jsx)("hr",{}),Object(c.jsx)(V,{connRef:e.connRef})]})}function $(e){return Object(c.jsx)("div",{children:Object(c.jsx)("button",{onClick:function(){return n=e.connRef.current,t=e.setMyOffer,console.log("create offer"),console.log(n.pc.signalingState),n.dc=n.pc.createDataChannel("chat"),n.dc.onopen=function(){return f(n)},n.dc.onmessage=function(e){return d(n,e)},n.pc.createOffer().then((function(e){return n.pc.setLocalDescription(e)})).catch(console.log),void(n.pc.onicecandidate=function(e){e.candidate||t(O(JSON.stringify(n.pc.localDescription)))});var n,t},children:"Create game"})})}function q(e){var n=Object(r.useState)(""),t=Object(i.a)(n,2),s=t[0],o=t[1];return Object(c.jsxs)("div",{children:["send this message to your friends: ",Object(c.jsx)("code",{children:e.offer}),Object(c.jsx)("br",{}),"input their answer:",Object(c.jsx)("input",{type:"text",value:s,onChange:function(e){return o(e.target.value)}}),Object(c.jsx)("button",{onClick:function(){return function(e,n){console.log("join"),console.log(e.pc.signalingState);var t=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(t).catch(console.log)}(e.connRef.current,s)},children:"Add player"})]})}function z(e){var n=Object(r.useState)(""),t=Object(i.a)(n,2),s=t[0],o=t[1];return Object(c.jsxs)("div",{children:[Object(c.jsx)("input",{type:"text",value:s,onChange:function(e){return o(e.target.value)}}),Object(c.jsx)("button",{onClick:function(){return function(e,n,t){console.log("join"),console.log(e.pc.signalingState);var c=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(c).then((function(){return e.pc.createAnswer()})).then((function(n){return e.pc.setLocalDescription(n)})).catch(console.log),e.pc.onicecandidate=function(n){n.candidate||t(O(JSON.stringify(e.pc.localDescription)))}}(e.connRef.current,s,e.setMyAnswer)},children:"Join"})]})}function Z(e){return Object(c.jsxs)("div",{children:["send this message to your friends: ",Object(c.jsx)("code",{children:e.answer}),Object(c.jsx)("br",{})]})}function ee(e){return console.log(e.connRef),Object(c.jsxs)("div",{children:[Object(c.jsx)($,{connRef:e.connRef,setMyOffer:e.setMyOffer}),Object(c.jsx)("br",{}),Object(c.jsx)(z,{connRef:e.connRef,setMyAnswer:e.setMyAnswer}),Object(c.jsx)("br",{})]})}function ne(e){return Object(c.jsxs)("div",{children:[e.offer?Object(c.jsx)(q,{connRef:e.connRef,offer:e.offer}):Object(c.jsx)(Z,{connRef:e.connRef,answer:e.answer}),Object(c.jsx)("hr",{}),"Participants list: idk",Object(c.jsx)("br",{}),Object(c.jsx)("hr",{}),Object(c.jsx)("button",{onClick:e.startGame,children:"Start game!"}),Object(c.jsx)("hr",{}),Object(c.jsx)(V,{connRef:e.connRef})]})}function te(e){var n=Object(r.useState)(null),t=Object(i.a)(n,2),o=t[0],a=t[1],u=Object(r.useState)(null),l=Object(i.a)(u,2),f=l[0],d=l[1];return o||f?Object(c.jsx)(ne,{connRef:e.connRef,offer:o,answer:f,startGame:e.startGame}):Object(c.jsx)(s.a.Fragment,{children:Object(c.jsx)(ee,{connRef:e.connRef,setMyOffer:a,setMyAnswer:d})})}D(JSON.stringify(H)===JSON.stringify(Object.keys(k)),{methods:H,handlers:k});var ce=function(){var e=Object(r.useState)(!0),n=Object(i.a)(e,2),t=n[0],s=n[1],o=Object(r.useRef)(),a=Object(r.useRef)(),u=Object(r.useCallback)((function(){s(!1),function(e){B.apply(this,arguments)}(a.current)}),[a]);return Object(r.useEffect)((function(){o.current=function(){var e={pc:new RTCPeerConnection(l),dc:null,messageHandlers:{},messageHandlersIndx:"0"};return e.pc.ondatachannel=function(n){e.dc=n.channel,e.dc.onopen=function(){return f(e)},e.dc.onmessage=function(n){return d(e,n)}},e.pc.oniceconnectionstatechange=function(n){return console.log(e.pc.iceConnectionState)},e}(),a.current=function(e){var n=Math.random().toString(36).substr(2,9);return{conn:e,listeners:{},listenerIndex:"0",phase:w.SETUP,userId:n,state:C.PRE_READY,players:[n],readyHashes:{},startNumbers:{},myRandom:null}}(o.current)}),[]),Object(r.useEffect)((function(){var e=j(o.current,(function(e){return function(e,n){console.log("game receiving message!"),console.log(n),"data"===n.type?(D(H.includes(n.method)),console.log(k),k[n.method](e,n)):console.log("ignoring non-data message")}(a.current,e)}));return function(){b(o.current,e)}}),[o,a]),Object(c.jsxs)("div",{className:"App",children:[t&&Object(c.jsx)(te,{connRef:o,startGame:u}),!t&&Object(c.jsx)(X,{connRef:o,gameRef:a})]})},re=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,32)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,s=n.getLCP,o=n.getTTFB;t(e),c(e),r(e),s(e),o(e)}))};a.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(ce,{})}),document.getElementById("root")),re()}},[[31,1,2]]]);
//# sourceMappingURL=main.eba0c894.chunk.js.map