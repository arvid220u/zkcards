(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{12:function(e,n,t){},13:function(e,n,t){"use strict";t.r(n);var c=t(0),o=t(1),r=t.n(o),s=t(5),a=t.n(s),i=(t(12),t(2)),u=(t(4),t(6)),l={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302"]}]};function f(e){console.log("opened chat!!"),console.log(e.messageHandlers);var n={type:"info",value:"successfully opened connection!!"};for(var t in e.messageHandlers)e.messageHandlers[t](n)}function j(e,n){console.log("received message!"),console.log(e.messageHandlers);var t=JSON.parse(n.data);for(var c in console.log(t),e.messageHandlers)e.messageHandlers[c](t)}function d(e,n){var t=e.messageHandlersIndx;return e.messageHandlers[t]=n,e.messageHandlersIndx="".concat(parseInt(t)+1),t}function g(e,n){console.log("removing key ".concat(n," from conn ").concat(e)),delete e.messageHandlers[n]}function b(e,n){e.dc.send(JSON.stringify(n))}function O(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function p(e){var n=e;return n.length%4!==0&&(n+="===".slice(0,4-n.length%4)),n=n.replace(/-/g,"+").replace(/_/g,"/"),atob(n)}function h(e){var n=Object(o.useState)(""),t=Object(i.a)(n,2),r=t[0],s=t[1],a=Object(o.useState)(""),u=Object(i.a)(a,2),l=u[0],f=u[1];function j(){b(e.connRef.current,{type:"message",message:r}),O(r),s("")}function O(e){f((function(n){return""===n?e:e+"\n"+n}))}return Object(o.useEffect)((function(){var n=d(e.connRef.current,(function(e){if("message"===e.type)return O(e.message);O(JSON.stringify(e))}));return function(){console.log("cleaning up chat!!! index ".concat(n)),g(e.connRef.current,n)}}),[e.connRef]),Object(c.jsxs)("div",{children:[Object(c.jsx)("input",{type:"text",value:r,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?j():0}}),Object(c.jsx)("button",{onClick:j,children:"Send message"}),Object(c.jsx)("p",{style:{whiteSpace:"pre-line"},children:l})]})}function x(e){return Object(c.jsxs)("div",{children:["welcome to the game good sir!",Object(c.jsx)("hr",{}),Object(c.jsx)(h,{connRef:e.connRef})]})}function m(e){return Object(c.jsx)("div",{children:Object(c.jsx)("button",{onClick:function(){return n=e.connRef.current,t=e.setMyOffer,console.log("create offer"),console.log(n.pc.signalingState),n.dc=n.pc.createDataChannel("chat"),n.dc.onopen=function(){return f(n)},n.dc.onmessage=function(e){return j(n,e)},n.pc.createOffer().then((function(e){return n.pc.setLocalDescription(e)})).catch(console.log),void(n.pc.onicecandidate=function(e){e.candidate||t(O(JSON.stringify(n.pc.localDescription)))});var n,t},children:"Create game"})})}function v(e){var n=Object(o.useState)(""),t=Object(i.a)(n,2),r=t[0],s=t[1];return Object(c.jsxs)("div",{children:["send this message to your friends: ",Object(c.jsx)("code",{children:e.offer}),Object(c.jsx)("br",{}),"input their answer:",Object(c.jsx)("input",{type:"text",value:r,onChange:function(e){return s(e.target.value)}}),Object(c.jsx)("button",{onClick:function(){return function(e,n){console.log("join"),console.log(e.pc.signalingState);var t=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(t).catch(console.log)}(e.connRef.current,r)},children:"Add player"})]})}function R(e){var n=Object(o.useState)(""),t=Object(i.a)(n,2),r=t[0],s=t[1];return Object(c.jsxs)("div",{children:[Object(c.jsx)("input",{type:"text",value:r,onChange:function(e){return s(e.target.value)}}),Object(c.jsx)("button",{onClick:function(){return function(e,n,t){console.log("join"),console.log(e.pc.signalingState);var c=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(c).then((function(){return e.pc.createAnswer()})).then((function(n){return e.pc.setLocalDescription(n)})).catch(console.log),e.pc.onicecandidate=function(n){n.candidate||t(O(JSON.stringify(e.pc.localDescription)))}}(e.connRef.current,r,e.setMyAnswer)},children:"Join"})]})}function y(e){return Object(c.jsxs)("div",{children:["send this message to your friends: ",Object(c.jsx)("code",{children:e.answer}),Object(c.jsx)("br",{})]})}function S(e){return console.log(e.connRef),Object(c.jsxs)("div",{children:[Object(c.jsx)(m,{connRef:e.connRef,setMyOffer:e.setMyOffer}),Object(c.jsx)("br",{}),Object(c.jsx)(R,{connRef:e.connRef,setMyAnswer:e.setMyAnswer}),Object(c.jsx)("br",{})]})}function C(e){return Object(c.jsxs)("div",{children:[e.offer?Object(c.jsx)(v,{connRef:e.connRef,offer:e.offer}):Object(c.jsx)(y,{connRef:e.connRef,answer:e.answer}),Object(c.jsx)("hr",{}),"Participants list: idk",Object(c.jsx)("br",{}),Object(c.jsx)("hr",{}),Object(c.jsx)("button",{onClick:e.startGame,children:"Start game!"}),Object(c.jsx)("hr",{}),Object(c.jsx)(h,{connRef:e.connRef})]})}function w(e){var n=Object(o.useState)(null),t=Object(i.a)(n,2),s=t[0],a=t[1],u=Object(o.useState)(null),l=Object(i.a)(u,2),f=l[0],j=l[1];return s||f?Object(c.jsx)(C,{connRef:e.connRef,offer:s,answer:f,startGame:e.startGame}):Object(c.jsx)(r.a.Fragment,{children:Object(c.jsx)(S,{connRef:e.connRef,setMyOffer:a,setMyAnswer:j})})}var H=function(){var e=Object(o.useState)(!0),n=Object(i.a)(e,2),t=n[0],r=n[1],s=Object(o.useRef)(),a=Object(o.useCallback)((function(){var e,n;r(!1),e=s.current,n={method:"START"},b(e,Object(u.a)({type:"data"},n))}),[s]);return Object(o.useEffect)((function(){s.current=function(){var e={pc:new RTCPeerConnection(l),dc:null,messageHandlers:{},messageHandlersIndx:"0"};return e.pc.ondatachannel=function(n){e.dc=n.channel,e.dc.onopen=function(){return f(e)},e.dc.onmessage=function(n){return j(e,n)}},e.pc.oniceconnectionstatechange=function(n){return console.log(e.pc.iceConnectionState)},e}()}),[]),Object(o.useEffect)((function(){var e=d(s.current,(function(e){"data"===e.type&&"START"===e.method&&r(!1)}));return function(){g(s.current,e)}}),[s]),Object(c.jsxs)("div",{className:"App",children:[t&&Object(c.jsx)(w,{connRef:s,startGame:a}),!t&&Object(c.jsx)(x,{connRef:s})]})},k=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,14)).then((function(n){var t=n.getCLS,c=n.getFID,o=n.getFCP,r=n.getLCP,s=n.getTTFB;t(e),c(e),o(e),r(e),s(e)}))};a.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(H,{})}),document.getElementById("root")),k()},4:function(e,n,t){}},[[13,1,2]]]);
//# sourceMappingURL=main.01e9c626.chunk.js.map