(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{10:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(20);function a(e,t){e||(console.error("assertion failed"),console.error(r.c(t)))}},149:function(e,t,n){},150:function(e,t,n){},159:function(e,t){},163:function(e,t){},165:function(e,t){},175:function(e,t){},177:function(e,t){},20:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return shuffle})),__webpack_require__.d(__webpack_exports__,"a",(function(){return compileUserRule})),__webpack_require__.d(__webpack_exports__,"e",(function(){return unimplemented})),__webpack_require__.d(__webpack_exports__,"b",(function(){return hash})),__webpack_require__.d(__webpack_exports__,"c",(function(){return objectify}));var _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__),_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_assert_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10);function shuffle(e,t){for(var n,r,a=e.length;0!==a;)r=Math.floor(t()*a),n=e[a-=1],e[a]=e[r],e[r]=n;return e}function compileUserRule(e){return _compileUserRule.apply(this,arguments)}function _compileUserRule(){return(_compileUserRule=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t){var n,r,a,c,s,o,u,i,l;return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=30,e.next=3,constructFunction(t);case 3:r=e.sent,a=new Array(n).fill(BigInt(0)),c=0;case 6:if(!(c<53)){e.next=29;break}s=0;case 8:if(!(s<53)){e.next=26;break}o=0;case 10:if(!(o<2)){e.next=23;break}return e.next=13,evaluateFuncRule(r,1===o,s,c);case 13:return u=e.sent,e.next=16,computeBitNumber(1===o,s,c);case 16:if(i=e.sent,!u){e.next=20;break}return e.next=20,populateBit(a,i);case 20:o++,e.next=10;break;case 23:s++,e.next=8;break;case 26:c++,e.next=6;break;case 29:for(a[29]=BigInt(Math.floor(1e6*Math.random())),console.log("result of compiling "+t+"is"),l=0;l<30;l++)a[l]="".concat(a[l]);return console.log(a),e.abrupt("return",a);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function constructFunction(e){return _constructFunction.apply(this,arguments)}function _constructFunction(){return(_constructFunction=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t){return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"async function f(lastcard, card1, card2){\n","\n}",e.abrupt("return","async function f(lastcard, card1, card2){\n".concat(t).concat("\n}"));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function evaluateFuncRule(e,t,n,r){return _evaluateFuncRule.apply(this,arguments)}function _evaluateFuncRule(){return _evaluateFuncRule=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function _callee3(funcRule,lastcard,card1,card2){var code;return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return code=funcRule+"\nf(".concat(lastcard,",").concat(card1,",").concat(card2,");"),_context3.prev=1,_context3.abrupt("return",eval(code));case 5:_context3.prev=5,_context3.t0=_context3.catch(1),_context3.t0 instanceof SyntaxError&&alert(_context3.t0.message);case 8:case"end":return _context3.stop()}}),_callee3,null,[[1,5]])}))),_evaluateFuncRule.apply(this,arguments)}function computeBitNumber(e,t,n){return _computeBitNumber.apply(this,arguments)}function _computeBitNumber(){return(_computeBitNumber=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t,n,r){return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t+2*n+106*r);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function populateBit(e,t){return _populateBit.apply(this,arguments)}function _populateBit(){return(_populateBit=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t,n){var r;return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t[(n-(r=n%200))/200]+=Math.pow(BigInt(2),BigInt(r));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function unimplemented(){Object(_assert_js__WEBPACK_IMPORTED_MODULE_2__.a)(!1,"not implemented yet!!")}function hash(e){return _hash.apply(this,arguments)}function _hash(){return(_hash=Object(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t){var n,r,a,c,s;return _Users_arvidlunnemark_code_eth_winter_snarkjs_zkcards_client_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,r=n.encode(t),e.next=4,crypto.subtle.digest("SHA-256",r);case 4:return a=e.sent,c=Array.from(new Uint8Array(a)),s=c.map((function(e){return e.toString(16).padStart(2,"0")})).join(""),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function objectify(e){return JSON.parse(JSON.stringify(e,(function(e,t){return"bigint"===typeof t?t.toString():t})))}},203:function(e,t){},205:function(e,t){},206:function(e,t){},211:function(e,t){},213:function(e,t){},232:function(e,t){},244:function(e,t){},247:function(e,t){},257:function(e,t,n){},258:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(6),c=n.n(a),s=n(138),o=n.n(s),u=(n(149),n(12)),i=(n(150),n(36)),l={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302"]}]};function d(e){console.log("opened chat!!"),console.log(e.messageHandlers);var t={type:"info",value:"successfully opened connection!!"};for(var n in e.messageHandlers)e.messageHandlers[n](t)}function f(e,t){console.log("received message!"),console.log(e.messageHandlers);var n=JSON.parse(t.data);for(var r in console.log(n),e.messageHandlers)e.messageHandlers[r](n)}function p(e,t){var n=e.messageHandlersIndx;return e.messageHandlers[n]=t,e.messageHandlersIndx="".concat(parseInt(n)+1),n}function _(e,t){e&&(console.log("removing key ".concat(t," from conn ").concat(e)),delete e.messageHandlers[t])}function b(e,t){e.dc.send(JSON.stringify(t))}function h(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function j(e){var t=e;return t.length%4!==0&&(t+="===".slice(0,4-t.length%4)),t=t.replace(/-/g,"+").replace(/_/g,"/"),atob(t)}var O=n(0),m=n.n(O),g=n(29),k=n(1),y=n(16),v=n(22),x=n(139),E=n.n(x),R=n(20),w="Q",S="K",A=["A","2","3","4","5","6","7","8","9","10","J",w,S],T=["spades","hearts","diamonds","clubs"],P="VOID_CARD";function C(e,t){var n=function(e){e||(e=0);var t,n=[],r=0,a=0,c=Object(y.a)(T);try{for(c.s();!(t=c.n()).done;){var s,o=t.value,u=0,i=Object(y.a)(A);try{for(i.s();!(s=i.n()).done;){var l=s.value;u>=e&&n.push({rank:l,suit:o,rank_index:u,suit_index:r,index:a}),u++,a++}}catch(d){i.e(d)}finally{i.f()}r++}}catch(d){c.e(d)}finally{c.f()}return n}(t);return R.d(n,e)}function M(e){var t="\ud83c\udca1".charCodeAt(0),n="\ud83c\udca1".charCodeAt(1);return String.fromCharCode(t)+String.fromCharCode(n+e.rank_index+16*e.suit_index+(e.rank===w||e.rank===S?1:0))}function I(e){return e===P?52:e.index}function D(e){return e.rank+e.suit.charAt(0).toUpperCase()}function U(e,t){return e===P||t===P?e===P&&t===P:e.index===t.index}var L=n(86),N="circuits/";function Y(e,t){return B.apply(this,arguments)}function B(){return(B=Object(k.a)(m.a.mark((function e(t,n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),console.log(n),e.next=4,L.a.fullProve(t,N.concat(n,"/compiled-circuit/circuit.wasm"),N.concat(n,"/keys/circuit_final.zkey"));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n){return H.apply(this,arguments)}function H(){return(H=Object(k.a)(m.a.mark((function e(t,n,r){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(N.concat(t,"/keys/verification_key.json")).then((function(e){return e.json()})).catch((function(e){return alert(e)}));case 2:return a=e.sent,e.next=5,L.a.verify(a,n,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=n(9),z=n(13),G=n(5),W=n.n(G),V=W()("21888242871839275222246405745257275088548364400416034343698204186575808495617"),J=["0","7120861356467848435263064379192047478074060781135320967663101236819528304084","5024705281721889198577876690145313457398658950011302225525409148828000436681","17980351014018068290387269214713820287804403312720763401943303895585469787384","19886576439381707240399940949310933992335779767309383709787331470398675714258","1213715278223786725806155661738676903520350859678319590331207960381534602599","18162138253399958831050545255414688239130588254891200470934232514682584734511","7667462281466170157858259197976388676420847047604921256361474169980037581876","7207551498477838452286210989212982851118089401128156132319807392460388436957","9864183311657946807255900203841777810810224615118629957816193727554621093838","4798196928559910300796064665904583125427459076060519468052008159779219347957","17387238494588145257484818061490088963673275521250153686214197573695921400950","10005334761930299057035055370088813230849810566234116771751925093634136574742","11897542014760736209670863723231849628230383119798486487899539017466261308762","16771780563523793011283273687253985566177232886900511371656074413362142152543","749264854018824809464168489785113337925400687349357088413132714480582918506","3683645737503705042628598550438395339383572464204988015434959428676652575331","7556750851783822914673316211129907782679509728346361368978891584375551186255","20391289379084797414557439284689954098721219201171527383291525676334308303023","18146517657445423462330854383025300323335289319277199154920964274562014376193","8080173465267536232534446836148661251987053305394647905212781979099916615292","10796443006899450245502071131975731672911747129805343722228413358507805531141","5404287610364961067658660283245291234008692303120470305032076412056764726509","4623894483395123520243967718315330178025957095502546813929290333264120223168","16845753148201777192406958674202574751725237939980634861948953189320362207797","4622170486584704769521001011395820886029808520586507873417553166762370293671","16688277490485052681847773549197928630624828392248424077804829676011512392564","11878652861183667748838188993669912629573713271883125458838494308957689090959","2436445725746972287496138382764643208791713986676129260589667864467010129482","1888098689545151571063267806606510032698677328923740058080630641742325067877","148924106504065664829055598316821983869409581623245780505601526786791681102","18875020877782404439294079398043479420415331640996249745272087358069018086569","15189693413320228845990326214136820307649565437237093707846682797649429515840","19669450123472657781282985229369348220906547335081730205028099210442632534079","5521922218264623411380547905210139511350706092570900075727555783240701821773","4144769320246558352780591737261172907511489963810975650573703217887429086546","10097732913112662248360143041019433907849917041759137293018029019134392559350","1720059427972723034107765345743336447947522473310069975142483982753181038321","6302388219880227251325608388535181451187131054211388356563634768253301290116","6745410632962119604799318394592010194450845483518862700079921360015766217097","10858157235265583624235850660462324469799552996870780238992046963007491306222","20241898894740093733047052816576694435372877719072347814065227797906130857593","10165780782761211520836029617746977303303335603838343292431760011576528327409","2832093654883670345969792724123161241696170611611744759675180839473215203706","153011722355526826233082383360057587249818749719433916258246100068258954737","20196970640587451358539129330170636295243141659030208529338914906436009086943","3180973917010545328313139835982464870638521890385603025657430208141494469656","17198004293191777441573635123110935015228014028618868252989374962722329283022","7642160509228669138628515458941659189680509753651629476399516332224325757132","19346204940546791021518535594447257347218878114049998691060016493806845179755","11501810868606870391127866188394535330696206817602260610801897042898616817272","3113973447392053821824427670386252797811804954746053461397972968381571297505","6545064306297957002139416752334741502722251869537551068239642131448768236585","5203908808704813498389265425172875593837960384349653691918590736979872578408","2246692432011290582160062129070762007374502637007107318105405626910313810224","11760570435432189127645691249600821064883781677693087773459065574359292849137","5543749482491340532547407723464609328207990784853381797689466144924198391839","8837549193990558762776520822018694066937602576881497343584903902880277769302","12855514863299373699594410385788943772765811961581749194183533625311486462501","5363660674689121676875069134269386492382220935599781121306637800261912519729","13162342403579303950549728848130828093497701266240457479693991108217307949435","916941639326869583414469202910306428966657806899788970948781207501251816730","15618589556584434434009868216186115416835494805174158488636000580759692174228","8959562060028569701043973060670353733575345393653685776974948916988033453971","16390754464333401712265575949874369157699293840516802426621216808905079127650","168282396747788514908709091757591226095443902501365500003618183905496160435","8327443473179334761744301768309008451162322941906921742120510244986704677004","17213012626801210615058753489149961717422101711567228037597150941152495100640","10394369641533736715250242399198097296122982486516256408681925424076248952280","17784386835392322654196171115293700800825771210400152504776806618892170162248","16533189939837087893364000390641148516479148564190420358849587959161226782982","18725396114211370207078434315900726338547621160475533496863298091023511945076","7132325028834551397904855671244375895110341505383911719294705267624034122405","148317947440800089795933930720822493695520852448386394775371401743494965187","19001050671757720352890779127693793630251266879994702723636759889378387053056","18824274411769830274877839365728651108434404855803844568234862945613766611460","12771414330193951156383998390424063470766226667986423961689712557338777174205","11332046574800279729678603488745295198038913503395629790213378101166488244657","9607550223176946388146938069307456967842408600269548190739947540821716354749","8756385288462344550200229174435953103162307705310807828651304665320046782583","176061952957067086877570020242717222844908281373122372938833890096257042779","12200212977482648306758992405065921724409841940671166017620928947866825250857","10868453624107875516866146499877130701929063632959660262366632833504750028858","2016095394399807253596787752134573207202567875457560571095586743878953450738","21815578223768330433802113452339488275704145896544481092014911825656390567514","4923772847693564777744725640710197015181591950368494148029046443433103381621","1813584943682214789802230765734821149202472893379265320098816901270224589984","10810123816265612772922113403831964815724109728287572256602010709288980656498","1153669123397255702524721206511185557982017410156956216465120456256288427021","5007518659266430200134478928344522649876467369278722765097865662497773767152","2511432546938591792036639990606464315121646668029252285288323664350666551637","32883284540320451295484135704808083452381176816565850047310272290579727564","10484856914279112612610993418405543310546746652738541161791501150994088679557","2026733759645519472558796412979210009170379159866522399881566309631434814953","14731806221235869882801331463708736361296174006732553130708107037190460654379","14740327483193277147065845135561988641238516852487657117813536909482068950652","18787428285295558781869865751953016580493190547148386433580291216673009884554","3804047064713122820157099453648459188816376755739202017447862327783289895072","16709604795697901641948603019242067672006293290826991671766611326262532802914","11061717085931490100602849654034280576915102867237101935487893025907907250695","2821730726367472966906149684046356272806484545281639696873240305052362149654","17467794879902895769410571945152708684493991588672014763135370927880883292655","1571520786233540988201616650622796363168031165456869481368085474420849243232","10041051776251223165849354194892664881051125330236567356945669006147134614302","3981753758468103976812813304477670033098707002886030847251581853700311567551","4365864398105436789177703571412645548020537580493599380018290523813331678900","2391801327305361293476178683853802679507598622000359948432171562543560193350","214219368547551689972421167733597094823289857206402800635962137077096090722","18192064100315141084242006659317257023098826945893371479835220462302399655674","15487549757142039139328911515400805508248576685795694919457041092150651939253","10142447197759703415402259672441315777933858467700579946665223821199077641122","11246573086260753259993971254725613211193686683988426513880826148090811891866","6574066859860991369704567902211886840188702386542112593710271426704432301235","11311085442652291634822798307831431035776248927202286895207125867542470350078","20977948360215259915441258687649465618185769343138135384346964466965010873779","792781492853909872425531014397300057232399608769451037135936617996830018501","5027602491523497423798779154966735896562099398367163998686335127580757861872","14595204575654316237672764823862241845410365278802914304953002937313300553572","13973538843621261113924259058427434053808430378163734641175100160836376897004","16395063164993626722686882727042150241125309409717445381854913964674649318585","8465768840047024550750516678171433288207841931251654898809033371655109266663","21345603324471810861925019445720576814602636473739003852898308205213912255830","21171984405852590343970239018692870799717057961108910523876770029017785940991","10761027113757988230637066281488532903174559953630210849190212601991063767647","6678298831065390834922566306988418588227382406175769592902974103663687992230","4993662582188632374202316265508850988596880036291765531885657575099537176757","18364168158495573675698600238443218434246806358811328083953887470513967121206","3506345610354615013737144848471391553141006285964325596214723571988011984829","248732676202643792226973868626360612151424823368345645514532870586234380100","10090204501612803176317709245679152331057882187411777688746797044706063410969","21297149835078365363970699581821844234354988617890041296044775371855432973500","16729368143229828574342820060716366330476985824952922184463387490091156065099","4467191506765339364971058668792642195242197133011672559453028147641428433293","8677548159358013363291014307402600830078662555833653517843708051504582990832","1022951765127126818581466247360193856197472064872288389992480993218645055345","1888195070251580606973417065636430294417895423429240431595054184472931224452","4221265384902749246920810956363310125115516771964522748896154428740238579824","2825393571154632139467378429077438870179957021959813965940638905853993971879","19171031072692942278056619599721228021635671304612437350119663236604712493093","10780807212297131186617505517708903709488273075252405602261683478333331220733","18230936781133176044598070768084230333433368654744509969087239465125979720995","16901065971871379877929280081392692752968612240624985552337779093292740763381","146494141603558321291767829522948454429758543710648402457451799015963102253","2492729278659146790410698334997955258248120870028541691998279257260289595548","2204224910006646535594933495262085193210692406133533679934843341237521233504","16062117410185840274616925297332331018523844434907012275592638570193234893570","5894928453677122829055071981254202951712129328678534592916926069506935491729","4947482739415078212217504789923078546034438919537985740403824517728200332286","16143265650645676880461646123844627780378251900510645261875867423498913438066","397690828254561723549349897112473766901585444153303054845160673059519614409","11272653598912269895509621181205395118899451234151664604248382803490621227687","15566927854306879444693061574322104423426072650522411176731130806720753591030","14222898219492484180162096141564251903058269177856173968147960855133048449557","16690275395485630428127725067513114066329712673106153451801968992299636791385","3667030990325966886479548860429670833692690972701471494757671819017808678584","21280039024501430842616328642522421302481259067470872421086939673482530783142","15895485136902450169492923978042129726601461603404514670348703312850236146328","7733050956302327984762132317027414325566202380840692458138724610131603812560","438123800976401478772659663183448617575635636575786782566035096946820525816","814913922521637742587885320797606426167962526342166512693085292151314976633","12368712287081330853637674140264759478736012797026621876924395982504369598764","2494806857395134874309386694756263421445039103814920780777601708371037591569","16101132301514338989512946061786320637179843435886825102406248183507106312877","6252650284989960032925831409804233477770646333900692286731621844532438095656","9277135875276787021836189566799935097400042171346561246305113339462708861695","10493603554686607050979497281838644324893776154179810893893660722522945589063","8673089750662709235894359384294076697329948991010184356091130382437645649279","9558393272910366944245875920138649617479779893610128634419086981339060613250","19012287860122586147374214541764572282814469237161122489573881644994964647218","9783723818270121678386992630754842961728702994964214799008457449989291229500","15550788416669474113213749561488122552422887538676036667630838378023479382689","15016165746156232864069722572047169071786333815661109750860165034341572904221","6506225705710197163670556961299945987488979904603689017479840649664564978574","10796631184889302076168355684722130903785890709107732067446714470783437829037","19871836214837460419845806980869387567383718044439891735114283113359312279540","20871081766843466343749609089986071784031203517506781251203251608363835140622","5100105771517691442278432864090229416166996183792075307747582375962855820797","8777887112076272395250620301071581171386440850451972412060638225741125310886","5300440870136391278944213332144327695659161151625757537632832724102670898756","1205448543652932944633962232545707633928124666868453915721030884663332604536","5542499997310181530432302492142574333860449305424174466698068685590909336771","11028094245762332275225364962905938096659249161369092798505554939952525894293","19187314764836593118404597958543112407224947638377479622725713735224279297009","17047263688548829001253658727764731047114098556534482052135734487985276987385","19914849528178967155534624144358541535306360577227460456855821557421213606310","2929658084700714257515872921366736697080475676508114973627124569375444665664","15092262360719700162343163278648422751610766427236295023221516498310468956361","21578580340755653236050830649990190843552802306886938815497471545814130084980","1258781501221760320019859066036073675029057285507345332959539295621677296991","3819598418157732134449049289585680301176983019643974929528867686268702720163","8653175945487997845203439345797943132543211416447757110963967501177317426221","6614652990340435611114076169697104582524566019034036680161902142028967568142","19212515502973904821995111796203064175854996071497099383090983975618035391558","18664315914479294273286016871365663486061896605232511201418576829062292269769","11498264615058604317482574216318586415670903094838791165247179252175768794889","10814026414212439999107945133852431304483604215416531759535467355316227331774","17566185590731088197064706533119299946752127014428399631467913813769853431107","14016139747289624978792446847000951708158212463304817001882956166752906714332","8242601581342441750402731523736202888792436665415852106196418942315563860366","9244680976345080074252591214216060854998619670381671198295645618515047080988","12216779172735125538689875667307129262237123728082657485828359100719208190116","10702811721859145441471328511968332847175733707711670171718794132331147396634","6479667912792222539919362076122453947926362746906450079329453150607427372979","15117544653571553820496948522381772148324367479772362833334593000535648316185","6842203153996907264167856337497139692895299874139131328642472698663046726780","12732823292801537626009139514048596316076834307941224506504666470961250728055","6936272626871035740815028148058841877090860312517423346335878088297448888663","17297554111853491139852678417579991271009602631577069694853813331124433680030","16641596134749940573104316021365063031319260205559553673368334842484345864859","7400481189785154329569470986896455371037813715804007747228648863919991399081","2273205422216987330510475127669563545720586464429614439716564154166712854048","15162538063742142685306302282127534305212832649282186184583465569986719234456","5628039096440332922248578319648483863204530861778160259559031331287721255522","16085392195894691829567913404182676871326863890140775376809129785155092531260","14227467863135365427954093998621993651369686288941275436795622973781503444257","18224457394066545825553407391290108485121649197258948320896164404518684305122","274945154732293792784580363548970818611304339008964723447672490026510689427","11050822248291117548220126630860474473945266276626263036056336623671308219529","2119542016932434047340813757208803962484943912710204325088879681995922344971","0"].map((function(e){return W()(e)})),q=function(){function e(t,n){Object(K.a)(this,e),this.l=void 0,this.r=void 0,this.rounds=void 0,this.k=void 0,this.l=W()(0),this.r=W()(0),this.rounds=t,this.k=n}return Object(z.a)(e,[{key:"inject",value:function(e){this.l=this.l.add(e).mod(V)}},{key:"mix",value:function(){for(var e=0;e<this.rounds-1;e++){var t=this.k.add(this.l).add(J[e]).mod(V).modPow(5,V).add(this.r).mod(V);this.r=this.l,this.l=t}var n=this.k.add(this.l).mod(V);this.r=n.modPow(5,V).add(this.r).mod(V)}}]),e}();function Z(e,t,n,r){var a,c=new q(n,W()(r)),s=Object(y.a)(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;c.inject(o),c.mix()}}catch(l){s.e(l)}finally{s.f()}for(var u=[c.l],i=0;i<t-1;i++)c.mix(),u.push(c.l);return u}var $=function(e){var t=W()(e).mod(V);return t.lesser(W()(0))&&(t=t.add(V)),t},Q=function(e,t){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return Z(r.map((function(e){return $(e)})),1,e,t)[0]}},X=Q(220,0),ee=(Q(4,0),Q(4,8),X),te="everyone";function ne(e,t,n,r){return re.apply(this,arguments)}function re(){return(re=Object(k.a)(m.a.mark((function e(t,n,r,a){var c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.t1=n,e.t2=r,e.t3=a,e.next=6,ce(n);case 6:return e.t4=e.sent,c={name:e.t0,source:e.t1,owner:e.t2,penalty:e.t3,compiled:e.t4,hash:null},e.t5="",e.next=11,ee.apply(void 0,Object(g.a)(c.compiled));case 11:return e.t6=e.sent,c.hash=e.t5.concat.call(e.t5,e.t6),e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return{name:e.name,owner:e.owner,hash:e.hash,penalty:e.penalty}}function ce(e){return se.apply(this,arguments)}function se(){return(se=Object(k.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("compiling source:"),console.log(t),e.next=4,R.a(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e,t){return e.hash===t.hash}function ue(e,t,n,r,a,c){return ie.apply(this,arguments)}function ie(){return(ie=Object(k.a)(m.a.mark((function e(t,n,r,a,c,s){var o,i,l,d,f,p,_,b,h,j,O,g,k;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={},i=Object(y.a)(a);try{for(i.s();!(l=i.n()).done;)d=l.value,o[d.hash]=d}catch(m){i.e(m)}finally{i.f()}f=[],p=Object(y.a)(c.entries()),e.prev=5,p.s();case 7:if((_=p.n()).done){e.next=23;break}return b=Object(u.a)(_.value,2),h=b[0],j=b[1],O="verifying ".concat(j.name,"; rule ").concat(h+1," of ").concat(c.length,"."),s(O),e.next=13,le(t,n,r,j,j.hash in o);case 13:return g=e.sent,k={},e.next=17,Y(g,"maoRule");case 17:k.proof=e.sent,k.rule=ae(j),k.penalty="0"===k.proof.publicSignals[0],f.push(k);case 21:e.next=7;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(5),p.e(e.t0);case 28:return e.prev=28,p.f(),e.finish(28);case 31:return s(null),e.abrupt("return",f);case 33:case"end":return e.stop()}}),e,null,[[5,25,28,31]])})))).apply(this,arguments)}function le(e,t,n,r,a){return de.apply(this,arguments)}function de(){return(de=Object(k.a)(m.a.mark((function e(t,n,r,a,c){var s,o,u,i,l,d;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=I(t),o=0===n.length?52:I(n[n.length-1]),u=1===r.length,i=a.hash,l=a.compiled,d=[u,s,o],e.abrupt("return",{rule:l,ruleHash:i,gameState:d,userAction:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe="INCORRECT_PENALTIES";function pe(e,t,n,r,a){return _e.apply(this,arguments)}function _e(){return(_e=Object(k.a)(m.a.mark((function e(t,n,r,a,c){var s,o,u,i,l,d,f,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={},o=Object(y.a)(a);try{for(o.s();!(u=o.n()).done;)i=u.value,s[i.hash]=i}catch(_){o.e(_)}finally{o.f()}l=[],d=Object(y.a)(c),e.prev=5,d.s();case 7:if((f=d.n()).done){e.next=21;break}return p=f.value,e.next=11,be(p.proof.publicSignals,t,n,r,p.rule.hash in s,p.rule.hash);case 11:if(e.t0=!e.sent,e.t0){e.next=16;break}return e.next=15,F("maoRule",p.proof.publicSignals,p.proof.proof);case 15:e.t0=!e.sent;case 16:if(!e.t0){e.next=18;break}return e.abrupt("return",fe);case 18:p.penalty&&l.push(p.rule);case 19:e.next=7;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(5),d.e(e.t1);case 26:return e.prev=26,d.f(),e.finish(26);case 29:return e.abrupt("return",l);case 30:case"end":return e.stop()}}),e,null,[[5,23,26,29]])})))).apply(this,arguments)}function be(e,t,n,r,a,c){return he.apply(this,arguments)}function he(){return(he=Object(k.a)(m.a.mark((function e(t,n,r,a,c,s){var o,u,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(I(n)),u=0===r.length?"52":"".concat(I(r[r.length-1])),i=1===a.length,console.log(t[1]===s),console.log(t[2]===(i?"1":"0")),console.log(t[3]===o),console.log(t[4]===u),console.log(t[5]===(c?"1":"0")),e.abrupt("return",t[1]===s&&t[2]===(i?"1":"0")&&t[3]===o&&t[4]===u&&t[5]===(c?"1":"0"));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je,Oe=n(10),me="STOCK",ge="HAND",ke="DISCARDED",ye=(je={},Object(v.a)(je,me,0),Object(v.a)(je,ge,1),Object(v.a)(je,ke,2),je);function ve(e){return xe.apply(this,arguments)}function xe(){return(xe=Object(k.a)(m.a.mark((function e(t){var n,r,a,c,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={tokenHashes:{},myTokens:Ee(),tokenStats:{}},r=Object(y.a)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return s=a.value,e.next=8,Se(Re(Ee()),10,0);case 8:n.tokenHashes[s]=e.sent,n.tokenStats[s]=(c={},Object(v.a)(c,me,10),Object(v.a)(c,ge,0),Object(v.a)(c,ke,0),c);case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function Ee(){var e=[{tokenPower:3,state:me,id:0},{tokenPower:2,state:me,id:1},{tokenPower:1,state:me,id:2},{tokenPower:1,state:me,id:3},{tokenPower:1,state:me,id:4},{tokenPower:0,state:me,id:5},{tokenPower:0,state:me,id:6},{tokenPower:0,state:me,id:7},{tokenPower:0,state:me,id:8},{tokenPower:0,state:me,id:9}];return Object(Oe.a)(10===e.length,"tokens must be sameeeee"),e}function Re(e){var t,n=0,r=1,a=Object(y.a)(e);try{for(a.s();!(t=a.n()).done;){n+=r*we(t.value.state),r*=3}}catch(c){a.e(c)}finally{a.f()}return n}function we(e){return Object(Oe.a)(Object.keys(ye).includes(e),"uh"),ye[e]}function Se(e,t,n){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(k.a)(m.a.mark((function e(t,n,r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0="",e.next=3,ee(t,n,r);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){return Ee().filter((function(t){return t.id===e}))[0].tokenPower}function Pe(e){return e.map((function(e){return"".concat(e.tokenPower)})).join(",")}function Ce(e,t,n,r,a,c,s){return Me.apply(this,arguments)}function Me(){return(Me=Object(k.a)(m.a.mark((function e(t,n,r,a,c,s,o){var u,l,d,f,p,_,b,h,j;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={oldCardstate:"".concat(Re(t.myTokens)),oldNumCardsInDeck:"".concat(t.tokenStats[o][me]),seed:"".concat(a),nonce:"".concat(s),opponentRandomness:"".concat(c)},e.next=3,Y(u,"drawcardspublicly");case 3:return l=(l=e.sent).publicSignals,d=l[0],f=l[1],(p=Object(i.a)({},u)).newCardstate="".concat(d),p.newNumCardsInDeck="".concat(f),p.salt1="".concat(n),p.salt2="".concat(r),console.log("qowierjfpoiqwejgfpowqejpoqwejfpoqwejfpioqwejfpoqwejfpoiqwefjpoiqwejf"),console.log(R.c(p)),e.next=16,Y(p,"drawcardsprivately");case 16:return _=e.sent,b=_.publicSignals[1],h=_.publicSignals[0],Object(Oe.a)(h===t.tokenHashes[o],"hashes should be same lolol"),console.log("SEEEEEEEEED: "),console.log(a),console.log("SEEEEDCOMMITTTTT:"),console.log(R.c(_)),console.log(h),console.log(t.tokenHashes[o]),console.log(R.c(t)),j=Math.round(Math.log(d-u.oldCardstate)/Math.log(3)),Object(Oe.a)(t.myTokens.filter((function(e){return e.id===j}))[0].state===me,"this should ne with the player"),t.myTokens.filter((function(e){return e.id===j}))[0].state=ge,e.abrupt("return",{newTokenHash:"".concat(b),proof:_});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ie="INCORRECTLY_DRAWN_TOKEN";function De(e,t,n,r,a,c){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(k.a)(m.a.mark((function e(t,n,r,a,c,s){var o,u,i,l,d,f;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.tokenHashes[r],u=n.proof,i=t.tokenStats[r][me],l=t.tokenStats[r][me]-1,console.log("HEEEEEEEEEEEEEEEEEEREEEEEEEEEEEEEEEEEEEEEEE\n\n\n\n\n\n\\n\n\n\n\\n\n\n\\n\n\n"),console.log(u.publicSignals[0]),console.log(o),console.log(u.publicSignals),console.log("HEEEEEEEEEEEEEEEEEEREEEEEEEEEEEEEEEEEEEEEEE\n\n\n\n\n\n\\n\n\n\n\\n\n\n\\n\n\n"),console.log("SEEEEEEEEED: "),console.log(s),u.publicSignals[0]===o){e.next=16;break}return console.log("Oh noo"),console.log(1),console.log(u.publicSignals[0]!==o),e.abrupt("return",Ie);case 16:if("".concat(i)===u.publicSignals[2]&&"".concat(l)===u.publicSignals[3]&&"".concat(s)===u.publicSignals[4]&&"".concat(a)===u.publicSignals[5]&&"".concat(c)===u.publicSignals[6]){e.next=24;break}return console.log("Oh noooo"),console.log(2),console.log(i!==u.publicSignals[2]),console.log(l!==u.publicSignals[3]),console.log(a!==u.publicSignals[4]),console.log(c!==u.publicSignals[5]),e.abrupt("return",Ie);case 24:return e.next=26,F("drawcardsprivately",u.publicSignals,u.proof);case 26:return d=e.sent,f=u.publicSignals[1],t.tokenHashes[r]=f,t.tokenStats[r][me]--,t.tokenStats[r][ge]++,e.abrupt("return",!!d||Ie);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,t,n,r,a){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(k.a)(m.a.mark((function e(t,n,r,a,c){var s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={cardNumber:"".concat(n.id),oldCardState:"".concat(Re(t.myTokens)),newCardState:"".concat(Re(t.myTokens)+Math.pow(3,n.id)),oldNumCardsInDeck:"".concat(t.tokenStats[c][me]),newNumCardsInDeck:"".concat(t.tokenStats[c][me]),salt1:"".concat(r),salt2:"".concat(a)},e.next=3,Y(s,"playCard");case 3:return o=e.sent,Object(Oe.a)(t.myTokens.filter((function(e){return e.id===n.id}))[0].state===ge,"card should be in hand@@@@@@bbbbbb"),t.myTokens.filter((function(e){return e.id===n.id}))[0].state=ke,e.abrupt("return",{newTokenHash:o.publicSignals[1],proof:o});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ye,Be="INCORRECTLY_PLAYED_TOKEN";function Fe(e,t,n,r){return He.apply(this,arguments)}function He(){return(He=Object(k.a)(m.a.mark((function e(t,n,r,a){var c,s,o,u,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.tokenStats[a][me],s=t.tokenStats[a][me],o=t.tokenHashes[a],(u=n.proof).publicSignals[0]===o&&u.publicSignals[2]==="".concat(r)){e.next=6;break}return e.abrupt("return",Be);case 6:if("".concat(c)===u.publicSignals[3]&&"".concat(s)===u.publicSignals[4]){e.next=8;break}return e.abrupt("return",Be);case 8:return e.next=10,F("playCard",u.publicSignals,u.proof);case 10:return i=e.sent,l=u.publicSignals[1],t.tokenHashes[a]=l,t.tokenStats[a][ge]--,t.tokenStats[a][ke]++,e.abrupt("return",!!i||Be);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ke={SETUP:"SETUP",PLAY:"PLAY",GAMEOVER:"GAMEOVER",ABORT:"ABORT"},ze=Object.values(Ke),Ge={PRE_READY:"PRE_READY",SENT_READY:"SENT_READY",SENT_START:"SENT_START"},We=(Object.values(Ge),{WAIT_FOR_PLAY:"WAIT_FOR_PLAY",WAIT_FOR_PLAYACK:"WAIT_FOR_PLAYACK"}),Ve=(Object.values(We),{READY:"READY",START:"START",PLAY:"PLAY",PLAYACK:"PLAYACK",FINALIZE:"FINALIZE",ABORT:"ABORT"}),Je=Object.values(Ve),qe=(Ye={},Object(v.a)(Ye,Ve.READY,(function(e,t){if(e.phase!==Ke.SETUP&&e.phase!==Ke.GAMEOVER)return lt(e);var n=e.data[Ke.SETUP];if(n.state!==Ge.PRE_READY&&n.state!==Ge.SENT_READY)return lt(e);var r=t.from,a=t.hash;if(n.players.includes(r))return lt(e);n.players.push(r),n.readyHashes[r]=a,xt(e),nt(e)})),Object(v.a)(Ye,Ve.START,(function(e,t){return at.apply(this,arguments)})),Object(v.a)(Ye,Ve.PLAY,(function(e,t){return ct.apply(this,arguments)})),Object(v.a)(Ye,Ve.PLAYACK,(function(e,t){return st.apply(this,arguments)})),Object(v.a)(Ye,Ve.FINALIZE,(function(e,t){return ut.apply(this,arguments)})),Object(v.a)(Ye,Ve.ABORT,(function(e,t){console.log("ABORTING :(((( SAD"),R.e(),nt(e)})),Ye);function Ze(e){var t,n={conn:e,listeners:{},listenerIndex:"0",userId:Math.random().toString(36).substr(2,9),phase:null,data:{},myRules:[],allRules:[],tokenState:null,numRounds:0,playerRandoms:{},prevSalt:0},r=Object(y.a)(ze);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.data[a]={}}}catch(c){r.e(c)}finally{r.f()}return Xe(n,Ke.SETUP),function(e){$e.apply(this,arguments)}(n),console.log("PERSISTENT GAME OBJECT:"),console.log(n),n}function $e(){return($e=Object(k.a)(m.a.mark((function e(t){var n,r,a,c,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=JSON.parse('[{"name": "spades", "source": "return card1 < 13;", "owner": "everyone", "compiled": ["5444517789605377000807312023119353348095", "22300744866223624195306750046696871313797120", "91343850972051964703976448191270384901313003520", "374144413581524847427487531791443496555778062417920", "1532495518029925775062988930217752561892466943663800320", "6277101641850575974658002658171914493511544601246926110720", "1606937661135105059069747502754722727590241779965516819988480", "1605368768825143605351003146283434881209071198220234113679375", "5316911903911500977350890647577493503", "21778071158421508003229248092477413392380", "89202979464894496781227000186787485255188480", "365375403888207858815905792765081539605252014080", "1496577654326099389709950127165773986223112249671680", "6129982072119703100251955720871010247569867774655201280", "25108406567402303898632010632687657974046178404987704442880", "1606936511763449409653103733995403102794358138513688774049792", "1600660942523603594778126308110251717269675811532557948813375", "21267647615646003909403562590309974015", "87112284633686032012916992369909653569520", "356811917859577987124908000747149941020753920", "1461501615552831435263623171060326158421008056320", "5986310617304397558839800508663095944892448998686720", "24519928288478812401007822883484040990279471098620805120", "100433626269609215594528042530750631896184713619950817771520", "1606931914276826811986528658958124603610823572706376590295040", "1581829637317443552486618955417519061512094264781853289349375", "85070590462584015637614250361239896063", "348449138534744128051667969479638614278080", "0", "717022"], "hash": "17205012832311340811919375832927141639902470640718918663600937074630886418595", "penalty": 1}, {"name": "lastcard", "source": "return lastcard;", "owner": "everyone", "compiled": ["1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "1071292029505993517027974728227441735014801995855195223534250", "174762", "465140"], "hash": "21230679390951108096990554741869645482032749412231210854096376350304594975156", "penalty": 2}, {"name": "have a nice day", "source": "return card1 % 13 === 6;", "owner": "everyone", "compiled": ["301300887788293773446888249548557771191567189891548616601600", "18389946764422227383232879752063607310570598236088696832", "75325221947073443361721875464452535544097170375019302224640", "4597486691105556080172894365904359035049782837534261248", "18831305486768357704388175322744254607563910502540334072000", "1149371659931159785689584661951516033716831152264445952", "4707826319078030482184538775353409674104140399675170619440", "71835729548524325715753614794864123151675984833609728", "294239148230755638131726806199763448429264833878465445900", "1205203551153175093787552998194231084766268759566194466406400", "73559787057688909532931519008254429242282392944354787328", "301300887788293773446887501857810142176388681500077208898560", "18389946764422224320691577463617436140199131350137044992", "75325221947073430817552701290977018430255642010161336288000", "4597486639724639142758338647806064134867324609057783808", "18831305276312121928738155101413638696416561598700682477760", "287342918194097302863014459179456492606703939334438912", "1176956592923022552526907224799053793717059335513861783600", "71835729548524325715753436531498466056916399359721472", "294239148230755638131726076033017716969129571777419149315", "1205203551153175093787550007431240568705554726000308835594240", "73559787057688897282766309854469744560796525400548179968", "301300887788293723270210805163908073721022568040645345152000", "18389946558898556571033354591224256539469298436231135232", "75325221105248487714952620405654554785666246394802729911040", "1149371672776389211452057836717825970426815757337755648", "4707826371692090210107628899196215174868237342055447134400", "287342918194097302863013746125993864227665597438885888", "12", "656804"], "hash": "2384772224768571088793082997670145304784266395039989777732184072162815188083", "penalty": 1}, {"name": "thank you", "source": "return card2 % 13 === 6;", "owner": "everyone", "compiled": ["0", "0", "0", "5575186299632655785383929568162021657018368", "0", "0", "0", "0", "0", "0", "1329227995784915872903807060280328192", "0", "0", "0", "0", "0", "1600660942523603594778126302917954936106100638338328800788480", "316912650057057350374175801343", "0", "0", "0", "0", "0", "1606938042762412598915117504100589333820729181655117911293952", "75557863725914323419135", "0", "0", "0", "0", "28819"], "hash": "1790166872727187973982917880744434754227559549735937037239485954634777301283", "penalty": 1}, {"name": "i salute the chair", "source": "return (card1 % 13) > 9", "owner": "everyone", "compiled": ["24136805128304173440493154674583484595123910184866414592", "98864353805533894412259961547093952901627536117212834169840", "6034201282076042355226923855249471233502839974263717888", "24716088451383469487009480111101834172427632534584188469500", "1508550303659647218717579868811364794253340887347085312", "6179022043789915007867207142651350197261684274573661438015", "1205203627478637739094649071182491370150813881911824720588800", "386188882052866775047891433137189526063410094465485897743", "1581829660888542310596163310129928298755727746930630237158400", "96547220513216693761972618698333938380495640739465658368", "395457415222135577649039846188375811606510144468851336679360", "24136805128304169420907695420997884934011359897054871552", "98864353805533877948037920444407336689710530138336753878000", "6034201214638588874870319475245459177013363549388341248", "24716088175159660031468828570605400789046737098294645752060", "377137580129752710007706477673036646546298920376451072", "1544755528211467100191565732548758104253640377861943590975", "1506504510777198415758766963496225387456302006374142442729472", "386188882052866775047890474793335753521982562957862633475", "1581829660888542310596159384753503246426040577875405346717440", "96547220513216677683630781683991539736045439588219486208", "395457415222135511792151681777629346758842120553347015512000", "24136804858554355499481277900981836708053454197553364992", "98864352700638640125875314282421603156186948393178583008240", "1508550320519010840030825910692146586185195681505804288", "6179022112845868400766262930195032417014561511447774363900", "1205203910331822836409181576961413742258599044148191265013760", "1544755528211467100191561899173343014087930251831450533903", "64512", "988211"], "hash": "10193634527461628677548098928674737437338433299539938568332421073540891325839", "penalty": 1}]'),r=0,a=Object(y.a)(n),e.prev=3,a.s();case 5:if((c=a.n()).done){e.next=16;break}if(s=c.value,!(r>=0)){e.next=9;break}return e.abrupt("break",16);case 9:t.myRules.push(s),o=ae(s),t.allRules.push(o),nt(t),r++;case 14:e.next=5;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),a.e(e.t0);case 21:return e.prev=21,a.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[3,18,21,24]])})))).apply(this,arguments)}function Qe(e,t,n){Object(Oe.a)(ze.includes(t),e);var r={};t===Ke.SETUP?r={state:Ge.PRE_READY,players:[e.userId],readyHashes:{},startNumbers:{},myRandom:null}:t===Ke.PLAY?(r.players=R.d(Object(g.a)(e.data[Ke.SETUP].players).sort(),n.rng),r.nextTurn=0,r.playedCards=[],r.playerHands=function(e,t,n){var r,a=C(t,n),c={},s=0,o=Object(y.a)(e);try{for(o.s();!(r=o.n()).done;)c[r.value]=[]}catch(l){o.e(l)}finally{o.f()}for(;s<a.length;){var u,i=Object(y.a)(e);try{for(i.s();!(u=i.n()).done;)c[u.value].push(a[s]),s++}catch(l){i.e(l)}finally{i.f()}}return c}(R.d(r.players,n.rng),n.rng,12),r.state=We.WAIT_FOR_PLAY,r.acksReceived=[],r.lastPlayedCard=null,r.lastPlayedUser=null,r.lastSelectedRules=null,r.penaltyRules=[],r.snarkStatus=null):t===Ke.GAMEOVER&&(r.winner=n.winner,r.sentFinalize=!1,r.finalizedReceived=[],r.readyToRestart=!1,r.didDrawTokens=!1,r.drawnTokens=[],r.compilingRule=!1,r.snarkStatus=null),e.data[t]=r}function Xe(e,t,n){Object(Oe.a)(ze.includes(t),e),Qe(e,t,n),e.phase=t}function et(e,t){var n=e.listenerIndex;return e.listeners[n]=t,e.listenerIndex="".concat(parseInt(n)+1),n}function tt(e,t){e&&(console.log("removing key ".concat(t," from game ").concat(e)),console.log(e),delete e.listeners[t])}function nt(e){for(var t=0,n=Object.values(e.listeners);t<n.length;t++){(0,n[t])()}}function rt(e,t){var n,r;t.from=e.userId,n=e.conn,r=t,b(n,Object(i.a)({type:"data"},r))}function at(){return(at=Object(k.a)(m.a.mark((function e(t,n){var r,a,c,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.phase===Ke.SETUP){e.next=2;break}return e.abrupt("return",lt(t,"wrong phase"));case 2:if((r=t.data[Ke.SETUP]).state===Ge.SENT_READY||r.state===Ge.SENT_START){e.next=5;break}return e.abrupt("return",lt(t));case 5:if(a=n.from,c=n.randomNumber,!Object.keys(r.startNumbers).includes(a)){e.next=9;break}return e.abrupt("return",lt(t));case 9:if(r.players.includes(a)){e.next=11;break}return e.abrupt("return",lt(t,"unknown user ".concat(a)));case 11:return e.next=13,R.b("".concat(c));case 13:if(s=e.sent,r.readyHashes[a]===s){e.next=16;break}return e.abrupt("return",lt(t,"incorrect hash ".concat(s," received for random number ").concat(c," from user ").concat(a)));case 16:r.startNumbers[a]=c,kt(t),nt(t);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(){return(ct=Object(k.a)(m.a.mark((function e(t,n){var r,a,c,s,o,u,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.phase===Ke.PLAY){e.next=2;break}return e.abrupt("return",lt(t,"wrong phase"));case 2:if((r=t.data[t.phase]).state===We.WAIT_FOR_PLAY){e.next=5;break}return e.abrupt("return",lt(t,"wrong state"));case 5:if(a=n.from,c=n.card,s=n.rules,o=n.provedRules,a===r.players[r.nextTurn]){e.next=11;break}return e.abrupt("return",lt(t,"user tried to make move but it's not their turn"));case 11:if(c===P||r.playerHands[a].some((function(e){return U(e,c)}))){e.next=13;break}return e.abrupt("return",lt(t,"user tried to play card not in their hand"));case 13:if(ft(t,c)){e.next=15;break}return e.abrupt("return",lt(t,"user tried to play illegal card"));case 15:if(u=t.allRules.filter((function(e){return e.owner===te||e.owner===a})).map((function(e){return e.hash})),i=o.map((function(e){return e.rule.hash})),JSON.stringify(u.sort())===JSON.stringify(i.sort())){e.next=19;break}return e.abrupt("return",lt(t,"did not prove outcomes for all rules user knows of"));case 19:return e.next=21,pe(c,r.playedCards,r.playerHands[a].filter((function(e){return!U(e,c)})),s,o);case 21:if((l=e.sent)!==fe){e.next=24;break}return e.abrupt("return",lt(t,"proofs were incorrect somehow :("));case 24:ot(t,l),dt(t,a,c,s),Ot(t,a,c,s),nt(t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(){return(st=Object(k.a)(m.a.mark((function e(t,n){var r,a,c,s,o,u,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.phase===Ke.PLAY){e.next=2;break}return e.abrupt("return",lt(t,"wrong phase"));case 2:if((r=t.data[t.phase]).state===We.WAIT_FOR_PLAYACK){e.next=5;break}return e.abrupt("return",lt(t,"wrong state"));case 5:if(a=n.user,c=n.from,s=n.card,o=n.provedRules,a===r.lastPlayedUser){e.next=11;break}return e.abrupt("return",lt(t,"tried to ack the wrong user"));case 11:if(U(s,r.lastPlayedCard)){e.next=13;break}return e.abrupt("return",lt(t,"tried to ack the wrong card"));case 13:if(!r.acksReceived.includes(c)){e.next=15;break}return e.abrupt("return",lt(t,"already received ack from this user"));case 15:if(u=t.allRules.filter((function(e){return e.owner===te||e.owner===c})).map((function(e){return e.hash})),i=o.map((function(e){return e.rule.hash})),JSON.stringify(u.sort())===JSON.stringify(i.sort())){e.next=19;break}return e.abrupt("return",lt(t,"did not prove outcomes for all rules user knows of"));case 19:return e.next=21,pe(s,r.playedCards.slice(0,r.playedCards.length-1),r.playerHands[a],r.lastSelectedRules,o);case 21:if((l=e.sent)!==fe){e.next=24;break}return e.abrupt("return",lt(t,"proofs were incorrect somehow :("));case 24:ot(t,l),r.acksReceived.push(c),jt(t),nt(t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e,t){var n,r=e.data[e.phase],a=Object(y.a)(t);try{for(a.s();!(n=a.n()).done;){var c=n.value;r.penaltyRules.includes(c)||r.penaltyRules.push(c)}}catch(s){a.e(s)}finally{a.f()}}function ut(){return(ut=Object(k.a)(m.a.mark((function e(t,n){var r,a,c,s,o,u,i,l,d;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("FINALIZE message received"),console.log(n),t.phase===Ke.GAMEOVER){e.next=4;break}return e.abrupt("return",lt(t,"wrong phase"));case 4:if(r=t.data[t.phase],a=n.from,c=n.rule,s=n.drawnTokens,o=n.tokenID,u=n.playedToken,!r.finalizedReceived.includes(a)){e.next=12;break}return e.abrupt("return",lt(t,"received two finalized from the same user"));case 12:i=Object(y.a)(s),e.prev=13,i.s();case 15:if((l=i.n()).done){e.next=24;break}return d=l.value,e.next=19,De(t.tokenState,d,a,t.playerRandoms[t.userId],t.numRounds,t.playerRandoms[a]);case 19:if(e.sent!==Ie){e.next=22;break}return e.abrupt("return",lt(t,"token was not drawn correctly"));case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),i.e(e.t0);case 29:return e.prev=29,i.f(),e.finish(29);case 32:if(!c){e.next=41;break}return t.allRules.push(c),e.next=36,Fe(t.tokenState,u,o,a);case 36:if(e.sent!==Be){e.next=39;break}return e.abrupt("return",lt(t,"token was not played correctly"));case 39:if(c.penalty===Te(o)){e.next=41;break}return e.abrupt("return",lt(t,"token was played correctly, but an unrelated penalty was used for the rule lol"));case 41:r.finalizedReceived.push(a),it(t),nt(t);case 44:case"end":return e.stop()}}),e,null,[[13,26,29,32]])})))).apply(this,arguments)}function it(e){Object(Oe.a)(e.phase===Ke.GAMEOVER,"duh");var t=e.data[e.phase];t.finalizedReceived.length===e.data[Ke.PLAY].players.length-1&&t.sentFinalize&&(console.log("finish finalize"),console.log(e),t.readyToRestart=!0,nt(e))}function lt(e,t){console.error("ABORT GAME :(("),console.error(t),rt(e,{method:Ve.ABORT,reason:t}),e.phase=Ke.ABORT,nt(e)}function dt(e,t,n,r){var a=e.data[e.phase];a.nextTurn=(a.nextTurn+1)%a.players.length,a.state=We.WAIT_FOR_PLAYACK,a.lastPlayedCard=n,a.lastPlayedUser=t,a.lastSelectedRules=r,n!==P&&(a.playedCards.push(n),a.playerHands[t]=a.playerHands[t].filter((function(e){return e.index!==n.index}))),nt(e)}function ft(e,t){var n=e.data[e.phase];if(t===P)return!0;if(0===n.playedCards.length)return!0;var r=n.playedCards[n.playedCards.length-1];return r.suit===t.suit||r.rank===t.rank}function pt(e,t,n){return _t.apply(this,arguments)}function _t(){return(_t=Object(k.a)(m.a.mark((function e(t,n,r){var a,c,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Oe.a)(t.phase===Ke.PLAY&&Tt(t),t),a=t.data[t.phase],Object(Oe.a)(a.state===We.WAIT_FOR_PLAY,t),Object(Oe.a)(n===P||a.playerHands[t.userId].some((function(e){return U(e,n)})),t),Object(Oe.a)(r.every((function(e){return t.allRules.filter((function(t){return oe(t,e)})).length>0})),t),console.log("play card!"),console.log(n),console.log(r),Object(Oe.a)(ft(t,n),t),e.next=11,ue(n,a.playedCards,a.playerHands[t.userId].filter((function(e){return!U(e,n)})),r,t.myRules,(function(e){return Ht(t,e)}));case 11:return c=e.sent,e.next=14,pe(n,a.playedCards,a.playerHands[t.userId].filter((function(e){return!U(e,n)})),r,c);case 14:s=e.sent,Object(Oe.a)(s!==fe,"your own penalty calculations were wrong lololol"),ot(t,s),rt(t,{method:Ve.PLAY,card:n,rules:r,provedRules:c}),dt(t,t.userId,n,r),nt(t);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e){return ht.apply(this,arguments)}function ht(){return(ht=Object(k.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Oe.a)(t.phase===Ke.SETUP,t),n=t.data[Ke.SETUP],Object(Oe.a)(n.state===Ge.PRE_READY,t),n.myRandom=Math.floor(Math.random()*Math.pow(2,64)),e.next=6,R.b("".concat(n.myRandom));case 6:r=e.sent,console.log(r),n.readyHashes[t.userId]=r,rt(t,{method:Ve.READY,hash:r}),n.state=Ge.SENT_READY,xt(t),nt(t);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(e){var t=e.data[e.phase];t.acksReceived.length===t.players.length-1&&(!function(e,t,n){console.log("enforce penalties:"),console.log(n);for(var r=e.data[e.phase],a=0;a<n.length&&r.playedCards.length>0;a++)for(var c=0;c<n[a].penalty&&r.playedCards.length>0;c++){var s=r.playedCards[0];r.playerHands[t].push(s),r.playedCards.splice(0,1)}var o=n.reduce((function(e,t){return e+t.penalty}),0);console.log("total penalty is: ".concat(o)),console.log("right before updating the game:"),console.log(R.c(e)),nt(e)}(e,t.lastPlayedUser,t.penaltyRules),t.state=We.WAIT_FOR_PLAY,t.acksReceived=[],t.lastPlayedCard=null,t.lastPlayedUser=null,t.lastSelectedRules=null,t.penaltyRules=[],function(e){Object(Oe.a)(e.phase===Ke.PLAY,e);var t=e.data[e.phase];Object(Oe.a)(t.state===We.WAIT_FOR_PLAY,e);var n,r=Object(y.a)(t.players);try{for(r.s();!(n=r.n()).done;){var a=n.value;0===t.playerHands[a].length&&(Object(Oe.a)(1===Object.values(t.playerHands).filter((function(e){return 0===e.length})).length),Xe(e,Ke.GAMEOVER,{winner:a}))}}catch(c){r.e(c)}finally{r.f()}}(e),nt(e))}function Ot(e,t,n,r){return mt.apply(this,arguments)}function mt(){return(mt=Object(k.a)(m.a.mark((function e(t,n,r,a){var c,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Oe.a)(t.phase===Ke.PLAY,t),c=t.data[t.phase],Object(Oe.a)(c.state===We.WAIT_FOR_PLAYACK,t),e.next=5,ue(r,c.playedCards.slice(0,c.playedCards.length-1),c.playerHands[n],a,t.myRules,(function(e){return Ht(t,e)}));case 5:return s=e.sent,e.next=8,pe(r,c.playedCards.slice(0,c.playedCards.length-1),c.playerHands[n],a,s);case 8:o=e.sent,Object(Oe.a)(o!==fe,"my own proofs were incorrect lolol im stupid"),ot(t,o),rt(t,{method:Ve.PLAYACK,card:r,user:n,provedRules:s}),Object(Oe.a)(!c.acksReceived.includes(t.userId),t),c.acksReceived.push(t.userId),jt(t),nt(t);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gt(){return(gt=Object(k.a)(m.a.mark((function e(t){var n,r,a,c,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(Oe.a)(t.phase===Ke.GAMEOVER,"pls be in gameover state sir"),n=t.data[t.phase],Object(Oe.a)(!n.didDrawTokens,"cannot draw tokens twice!!!!!"),n.didDrawTokens=!0,nt(t),r=Nt(t),console.log("drawing ".concat(r," tokens!")),a=0;case 8:if(!(a<r)){e.next=24;break}return c=Math.floor(Math.random()*Math.pow(2,64)),zt(t,"drawing token ".concat(a+1," of ").concat(r)),e.next=13,Ce(t.tokenState,t.prevSalt,c,t.playerRandoms[t.userId],t.playerRandoms[wt(t)],t.numRounds,t.userId);case 13:return s=e.sent,t.prevSalt=c,n.drawnTokens.push(s),e.next=18,De(t.tokenState,s,t.userId,t.playerRandoms[wt(t)],t.numRounds,t.playerRandoms[t.userId]);case 18:o=e.sent,Object(Oe.a)(o!==Ie,"verification is wrong"),nt(t);case 21:a++,e.next=8;break;case 24:zt(t,null);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kt(e){var t=e.data[e.phase];t.players.length===Object.keys(t.startNumbers).length&&function(e){Object(Oe.a)(e.phase===Ke.SETUP);var t=e.data[e.phase];Object(Oe.a)(t.state===Ge.SENT_START,e);var n=0;Object.values(t.startNumbers).forEach((function(e){n^=e})),console.log("final randomness: ".concat(n));var r=E()("".concat(n));e.playerRandoms=Object(i.a)({},t.startNumbers),Xe(e,Ke.PLAY,{rng:r}),Qe(e,Ke.SETUP),console.log("STARTING GAME!!!! exciting :)))"),console.log(e),nt(e)}(e)}function yt(e,t,n,r){return vt.apply(this,arguments)}function vt(){return(vt=Object(k.a)(m.a.mark((function e(t,n,r,a){var c,s,o,u,l,d,f;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(Oe.a)(t.phase===Ke.GAMEOVER,"submit rule only when game over lol"),c=t.data[t.phase],Object(Oe.a)(!c.sentFinalize,"cannot submit rules twice!"),console.log("creating a rule:"),console.log(n),c.compilingRule=!0,nt(t),s={},!n){e.next=28;break}return Object(Oe.a)(t.tokenState.myTokens.filter((function(e){return e.id===a.id&&e.state===ge})),"we need to own the token to use it"),o=Math.floor(Math.random()*Math.pow(2,64)),e.next=13,Le(t.tokenState,a,t.prevSalt,o,t.userId);case 13:return u=e.sent,t.prevSalt=o,e.next=17,Fe(t.tokenState,u,a.id,t.userId);case 17:return l=e.sent,Object(Oe.a)(l!==Be,"token must be drawn correctly"),Object(Oe.a)(a.tokenPower===Te(a.id),"id must match the power"),e.next=22,ne(r,n,t.userId,a.tokenPower);case 22:d=e.sent,t.myRules.push(d),f=ae(d),t.allRules.push(f),nt(t),s={rule:f,tokenID:a.id,playedToken:u};case 28:rt(t,Object(i.a)({method:Ve.FINALIZE,drawnTokens:c.drawnTokens},s)),c.sentFinalize=!0,it(t),nt(t);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xt(e){var t=e.data[Ke.SETUP];e.conn,1===Object.keys(t.readyHashes).length-1&&(Object(Oe.a)(t.players.length===Object.keys(t.readyHashes).length,e),function(e){Et.apply(this,arguments)}(e))}function Et(){return(Et=Object(k.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(Oe.a)(t.phase===Ke.SETUP,t),n=t.data[t.phase],Object(Oe.a)(n.state===Ge.SENT_READY,t),rt(t,{method:Ve.START,randomNumber:n.myRandom}),n.startNumbers[t.userId]=n.myRandom,n.state=Ge.SENT_START,null!==t.tokenState){e.next=10;break}return e.next=9,ve(n.players);case 9:t.tokenState=e.sent;case 10:kt(t),nt(t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(e){return e.userId}function wt(e){return e.data[Ke.PLAY].players.filter((function(t){return t!==Rt(e)}))[0]}function St(e){var t=e.data[Ke.PLAY];return Object(g.a)(t.playerHands[Rt(e)])}function At(e){var t=e.data[Ke.PLAY].playerHands[wt(e)];return Object(g.a)(t)}function Tt(e){var t=e.data[Ke.PLAY];return Rt(e)===t.players[t.nextTurn]}function Pt(e){var t=e.data[Ke.PLAY];return Tt(e)&&t.state===We.WAIT_FOR_PLAY}function Ct(e){var t=e.data[Ke.PLAY];return Object(g.a)(t.playedCards)}function Mt(e){return e.data[Ke.GAMEOVER].winner}function It(e){return Object(g.a)(e.allRules)}function Dt(e){return null===e.tokenState?null:Object(g.a)(e.tokenState.myTokens)}function Ut(e){var t=e.data[Ke.GAMEOVER];return e.phase===Ke.GAMEOVER&&t.readyToRestart}function Lt(e){var t=e.data[Ke.GAMEOVER];return e.phase===Ke.GAMEOVER&&!t.didDrawTokens}function Nt(e){Object(Oe.a)(e.phase===Ke.GAMEOVER,"u need to be in gameover to get tokens");var t,n=0===(t=St(e).length)?3:1===t?2:t<5?1:0,r=e.tokenState.myTokens.filter((function(e){return e.state===me})).length;return Math.min(n,r)}function Yt(e){return e.tokenState?Object(g.a)(e.tokenState.myTokens.filter((function(e){return e.state===ge}))):[]}function Bt(e){if(e.phase!==Ke.GAMEOVER)return!1;var t=e.data[Ke.GAMEOVER];return!t.sentFinalize&&!t.compilingRule}function Ft(e){return e.phase!==Ke.PLAY?null:e.data[e.phase].snarkStatus}function Ht(e,t){e.phase===Ke.PLAY&&(e.data[e.phase].snarkStatus=t,nt(e))}function Kt(e){return e.phase!==Ke.GAMEOVER?null:e.data[e.phase].snarkStatus}function zt(e,t){e.phase===Ke.GAMEOVER&&(e.data[e.phase].snarkStatus=t,nt(e))}Object(Oe.a)(JSON.stringify(Je)===JSON.stringify(Object.keys(qe)),{methods:Je,handlers:qe});n(257);function Gt(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(a.useState)(""),i=Object(u.a)(o,2),l=i[0],d=i[1];function f(){b(e.connRef.current,{type:"message",message:c}),h(c),s("")}function h(e){d((function(t){return""===t?e:e+"\n"+t}))}return Object(a.useEffect)((function(){var t=p(e.connRef.current,(function(e){if("message"===e.type)return h(e.message);h(JSON.stringify(e))}));return function(){console.log("cleaning up chat!!! index ".concat(t)),_(e.connRef.current,t)}}),[e.connRef]),Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:c,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?f():0},placeholder:"(say hi)"}),Object(r.jsx)("button",{onClick:f,children:"send message"}),Object(r.jsx)("p",{style:{whiteSpace:"pre-line",color:"rgba(0,0,0,0.5)"},children:l})]})}function Wt(){return Object(r.jsx)("div",{children:"waiting for everyone else to press start..."})}function Vt(e){var t=Object(a.useState)(Ct(e.gameRef.current)),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(a.useState)(St(e.gameRef.current)),i=Object(u.a)(o,2),l=i[0],d=i[1],f=Object(a.useState)(At(e.gameRef.current)),p=Object(u.a)(f,2),_=p[0],b=p[1],h=Object(a.useState)(Rt(e.gameRef.current)),j=Object(u.a)(h,2),O=j[0],m=j[1],k=Object(a.useState)(wt(e.gameRef.current)),y=Object(u.a)(k,2),v=y[0],x=y[1],E=Object(a.useState)(null),w=Object(u.a)(E,2),S=w[0],C=w[1],M=Object(a.useState)(Pt(e.gameRef.current)),I=Object(u.a)(M,2),D=I[0],U=I[1],L=Object(a.useState)([]),N=Object(u.a)(L,2),Y=N[0],B=N[1],F=Object(a.useState)(Ft(e.gameRef.current)),H=Object(u.a)(F,2),K=H[0],z=H[1],G=Object(a.useCallback)((function(e){C(e.currentTarget.value)}),[]),W=Object(a.useCallback)((function(e){var t=JSON.parse(e.currentTarget.value);console.log("toggling rule ".concat(t.name)),Y.filter((function(e){return oe(e,t)})).length>0?B(Y.filter((function(e){return!oe(e,t)}))):B([t].concat(Object(g.a)(Y)))}),[Y]),V=Object(a.useCallback)((function(){console.log("updating game state in Play :))))))"),console.log(R.c(e.gameRef.current)),s(Ct(e.gameRef.current)),d(St(e.gameRef.current)),b(At(e.gameRef.current)),m(Rt(e.gameRef.current)),x(wt(e.gameRef.current)),U(Pt(e.gameRef.current)),z(Ft(e.gameRef.current))}),[e.gameRef]);return Object(a.useEffect)((function(){var t=et(e.gameRef.current,V);return function(){tt(e.gameRef.current,t)}}),[e.gameRef,V]),Object(r.jsxs)("div",{children:[Object(r.jsx)(Qt,{cards:_,user:v}),Object(r.jsx)($t,{cards:c}),Object(r.jsx)(Xt,{cards:l,user:O,changeCard:G,selectedCard:S}),Object(r.jsx)(qt,{rules:e.rules,selectedRules:Y,toggleRule:W}),Object(r.jsx)(Zt,{disabled:!D||e.disabled,play:function(){if(null===S)return alert("pls select a card!");pt(e.gameRef.current,function(e){var t="\ud83c\udca1".charCodeAt(1),n=e.charCodeAt(1)-t,r=Math.floor(n/16),a=n%16;return a>=12&&a--,{suit:T[r],rank:A[a],suit_index:r,rank_index:a,index:13*r+a}}(S),Y),B([]),C(null)},pass:function(){pt(e.gameRef.current,P,Y),B([]),C(null)}}),K&&Object(r.jsx)(Jt,{text:K})]})}function Jt(e){return Object(r.jsxs)("div",{children:[e.text,"..."]})}function qt(e){return Object(r.jsxs)("div",{style:{marginTop:"5px",marginBottom:"7px"},children:["actions:",0===e.rules.length?" (none)":"",Object(r.jsx)("div",{className:"SelectRule",children:e.rules.map((function(t,n){return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)("input",{type:"checkbox",name:"rules",value:JSON.stringify(t),checked:e.selectedRules.filter((function(e){return oe(e,t)})).length>0,onChange:e.toggleRule,id:t.hash},"rulesradio".concat(n)),Object(r.jsx)("label",{htmlFor:t.hash,children:t.name},"ruleslabel".concat(n))]},"rulesfragment".concat(n))}))})]})}function Zt(e){return Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:e.play,disabled:e.disabled,children:"play!"}),Object(r.jsx)("button",{onClick:e.pass,disabled:e.disabled,children:"pass"})]})}function $t(e){return Object(r.jsxs)("div",{style:{margin:"5px"},children:["played cards: ",Object(r.jsx)(en,{cards:e.cards})]})}function Qt(e){return Object(r.jsxs)("div",{children:[e.user,"'s cards:",Object(r.jsx)(en,{cards:e.cards})]})}function Xt(e){return Object(r.jsxs)("div",{children:["my cards:",Object(r.jsx)(tn,{cards:e.cards,changeCard:e.changeCard,selectedCard:e.selectedCard})]})}function en(e){return Object(r.jsx)(tn,{cards:e.cards,disabled:!0})}function tn(e){return 0===e.cards.length?Object(r.jsx)("div",{children:"(none)"}):Object(r.jsx)("div",{style:{fontSize:"4em"},className:"SelectableDeck",children:e.cards.map((function(t,n){return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)("input",{type:"radio",name:"mycards",value:M(t),checked:e.selectedCard===M(t),onChange:e.changeCard,id:D(t),disabled:e.disabled},"mycardsradio".concat(n)),Object(r.jsx)("label",{htmlFor:D(t),style:e.disabled?{cursor:"default"}:{},children:M(t)},"mycardslabel".concat(n))]},"mycardsfragment".concat(n))}))})}function nn(e){var t=Object(a.useState)(Mt(e.gameRef.current)),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(a.useState)(Ut(e.gameRef.current)),i=Object(u.a)(o,2),l=i[0],d=i[1],f=Object(a.useState)(St(e.gameRef.current).length),p=Object(u.a)(f,2),_=p[0],b=p[1],h=Object(a.useState)(Lt(e.gameRef.current)),j=Object(u.a)(h,2),O=j[0],m=j[1],g=Object(a.useState)(Nt(e.gameRef.current)),k=Object(u.a)(g,2),y=k[0],v=k[1],x=Object(a.useState)(Yt(e.gameRef.current)),E=Object(u.a)(x,2),R=E[0],w=E[1],S=Object(a.useState)(Bt(e.gameRef.current)),A=Object(u.a)(S,2),T=A[0],P=A[1],C=Object(a.useState)(Kt(e.gameRef.current)),M=Object(u.a)(C,2),I=M[0],D=M[1],U=Object(a.useCallback)((function(){s(Mt(e.gameRef.current)),d(Ut(e.gameRef.current)),b(St(e.gameRef.current).length),m(Lt(e.gameRef.current)),v(Nt(e.gameRef.current)),w(Yt(e.gameRef.current)),P(Bt(e.gameRef.current)),D(Kt(e.gameRef.current))}),[e.gameRef]);return Object(a.useEffect)((function(){var t=et(e.gameRef.current,U);return function(){tt(e.gameRef.current,t)}}),[e.gameRef,U]),Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{style:{fontSize:"2em"},children:["game over!! ",c===e.userId?"you":c," won!"]}),"because you ended with ",_," card",1===_?"":"s"," left, you are awarded ",y," token",1===y?"":"s",", randomly drawn from the available tokens:",Object(r.jsx)("br",{}),Object(r.jsxs)("button",{onClick:function(){return function(e){return gt.apply(this,arguments)}(e.gameRef.current)},disabled:!O,children:["draw ",y," token",1===y?"":"s","!"]}),Object(r.jsx)(rn,{tokens:R,gameRef:e.gameRef,canSubmit:T}),l&&Object(r.jsx)("button",{onClick:function(){return(t=e.gameRef.current).phase=Ke.SETUP,t.numRounds++,void bt(t);var t},children:"play again!"}),I&&Object(r.jsx)(Jt,{text:I})]})}function rn(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),s=n[0],o=n[1],i=Object(a.useState)(null),l=Object(u.a)(i,2),d=l[0],f=l[1],p=Object(a.useState)(""),_=Object(u.a)(p,2),b=_[0],h=_[1],j=0===e.tokens.filter((function(e){return e.tokenPower>0})).length;return Object(r.jsxs)("div",{children:["create a rule:",Object(r.jsx)("br",{}),!j&&"token (# penalty cards):"," ",e.tokens.filter((function(e){return e.tokenPower>0})).map((function(e,t){return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)("input",{type:"radio",name:"tokens",value:e.tokenPower,checked:null!==d&&d.id===e.id,onChange:function(){return f(e)},id:e.id},"tokeninp".concat(t)),Object(r.jsx)("label",{htmlFor:e.id,children:e.tokenPower},"tokenlab".concat(t))]},"token".concat(t))})),!j&&Object(r.jsx)("br",{}),j&&Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)("span",{children:"you don't have any valuable tokens so you can't create any rules :("}),Object(r.jsx)("br",{})]}),Object(r.jsx)("input",{type:"text",value:b,onChange:function(e){return h(e.target.value)},placeholder:"(rule name)",disabled:!e.canSubmit||j}),Object(r.jsx)("br",{}),Object(r.jsx)("span",{style:{fontSize:"0.8em",color:"rgba(0,0,0,0.5)"},children:"function rule(card1: number, card2: number, lastcard: boolean) -> boolean:"}),Object(r.jsx)("br",{}),Object(r.jsx)("textarea",{style:{width:"250px",height:"50px"},value:s,onChange:function(e){return o(e.target.value)},placeholder:"(rule code)",disabled:!e.canSubmit||j}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{onClick:function(){return null===d?alert("pls select a token"):""===b?alert("pls enter a rule name"):""===s?alert("pls enter rule code"):void yt(e.gameRef.current,s,b,d)},disabled:!e.canSubmit||j,children:"create rule!"}),Object(r.jsx)("button",{onClick:function(){return yt(e.gameRef.current,null,null,null)},disabled:!e.canSubmit,children:"skip creating a rule"})]})}function an(e){return Object(r.jsxs)("div",{children:["active rules:"," ",e.rules.length>0&&Object(r.jsx)("ul",{children:e.rules.map((function(e){return Object(r.jsx)("li",{children:Object(r.jsx)(cn,{rule:e},e.hash)},e.hash)}))}),0===e.rules.length&&Object(r.jsx)("span",{children:"(none)"})]})}function cn(e){var t=e.rule;return Object(r.jsxs)("span",{title:"hash: "+t.hash,children:[t.name," (penalty ",t.penalty,", owned by ",t.owner,")"]})}function sn(e){var t=e.tokens.filter((function(e){return e.state===me})),n=e.tokens.filter((function(e){return e.state===ge}));return Object(r.jsxs)("div",{children:["my tokens:"," ",0===n.length?"none":Pe(n)," ","(available tokens: ",Pe(t),")"]})}function on(e){var t=Object(a.useState)(e.gameRef.current.phase),n=Object(u.a)(t,2),s=n[0],o=n[1],i=Object(a.useState)(Rt(e.gameRef.current)),l=Object(u.a)(i,2),d=l[0],f=l[1],p=Object(a.useState)(It(e.gameRef.current)),_=Object(u.a)(p,2),b=_[0],h=_[1],j=Object(a.useState)(Dt(e.gameRef.current)),O=Object(u.a)(j,2),m=O[0],g=O[1],k=Object(a.useCallback)((function(){o(e.gameRef.current.phase),f(Rt(e.gameRef.current)),h(It(e.gameRef.current)),g(Dt(e.gameRef.current))}),[e.gameRef]);return Object(a.useEffect)((function(){var t=et(e.gameRef.current,k);return function(){tt(e.gameRef.current,t)}}),[e.gameRef,k]),Object(r.jsxs)("div",{children:["welcome to the game, ",d,"!",Object(r.jsx)("hr",{}),s===Ke.GAMEOVER&&Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(nn,{gameRef:e.gameRef,userId:d}),Object(r.jsx)("hr",{})]}),s===Ke.SETUP&&Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(Wt,{}),Object(r.jsx)("hr",{})]}),Object(r.jsx)(an,{rules:b}),m&&Object(r.jsx)(sn,{tokens:m}),Object(r.jsx)("hr",{}),(s===Ke.PLAY||s===Ke.GAMEOVER)&&Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(Vt,{gameRef:e.gameRef,disabled:s===Ke.GAMEOVER,rules:b}),Object(r.jsx)("hr",{})]}),Object(r.jsx)(Gt,{connRef:e.connRef})]})}function un(e){return Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:function(){return t=e.connRef.current,n=e.setMyOffer,console.log("create offer"),console.log(t.pc.signalingState),t.dc=t.pc.createDataChannel("chat"),t.dc.onopen=function(){return d(t)},t.dc.onmessage=function(e){return f(t,e)},t.pc.createOffer().then((function(e){return t.pc.setLocalDescription(e)})).catch(console.log),void(t.pc.onicecandidate=function(e){e.candidate||n(h(JSON.stringify(t.pc.localDescription)))});var t,n},children:"create game"})})}function ln(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(a.useCallback)((function(){!function(e,t){console.log("join"),console.log(e.pc.signalingState);var n=new RTCSessionDescription(JSON.parse(j(t)));e.pc.setRemoteDescription(n).catch(console.log)}(e.connRef.current,c)}),[e.connRef,c]);return Object(r.jsxs)("div",{children:["1. send this key to your friend: ",Object(r.jsx)("code",{children:e.offer}),Object(r.jsx)("hr",{}),"2. input their key:"," ",Object(r.jsx)("input",{type:"text",value:c,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?o():0},placeholder:"(paste key here)"}),Object(r.jsx)("button",{onClick:o,children:"connect"})]})}function dn(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(a.useCallback)((function(){!function(e,t,n){console.log("join"),console.log(e.pc.signalingState);var r=new RTCSessionDescription(JSON.parse(j(t)));e.pc.setRemoteDescription(r).then((function(){return e.pc.createAnswer()})).then((function(t){return e.pc.setLocalDescription(t)})).catch(console.log),e.pc.onicecandidate=function(t){t.candidate||n(h(JSON.stringify(e.pc.localDescription)))}}(e.connRef.current,c,e.setMyAnswer)}),[e.connRef,e.setMyAnswer,c]);return Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:c,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?o():0},placeholder:"(paste key here)"}),Object(r.jsx)("button",{onClick:o,children:"join game"})]})}function fn(e){return Object(r.jsxs)("div",{children:["1. send this key to your friend: ",Object(r.jsx)("code",{children:e.answer}),Object(r.jsx)("br",{})]})}function pn(e){return console.log(e.connRef),Object(r.jsxs)("div",{children:[Object(r.jsx)(un,{connRef:e.connRef,setMyOffer:e.setMyOffer}),Object(r.jsx)("br",{}),Object(r.jsx)(dn,{connRef:e.connRef,setMyAnswer:e.setMyAnswer}),Object(r.jsx)("br",{}),Object(r.jsx)("a",{href:"https://github.com/arvid220u/zkcards",children:"github"})]})}function _n(e){var t=Object(a.useState)(0),n=Object(u.a)(t,2),c=n[0],s=n[1];return Object(a.useEffect)((function(){var t=p(e.connRef.current,(function(t){return s((e.connRef.current,1))}));return function(){_(e.connRef.current,t)}}),[e.connRef]),Object(r.jsxs)("div",{children:[e.offer?Object(r.jsx)(ln,{connRef:e.connRef,offer:e.offer}):Object(r.jsx)(fn,{connRef:e.connRef,answer:e.answer}),Object(r.jsx)("hr",{}),Object(r.jsx)("button",{onClick:e.startGame,disabled:0===c,children:"start game!"}),Object(r.jsx)("hr",{}),Object(r.jsx)(Gt,{connRef:e.connRef})]})}function bn(e){var t=Object(a.useState)(null),n=Object(u.a)(t,2),s=n[0],o=n[1],i=Object(a.useState)(null),l=Object(u.a)(i,2),d=l[0],f=l[1];return s||d?Object(r.jsx)(_n,{connRef:e.connRef,offer:s,answer:d,startGame:e.startGame}):Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(pn,{connRef:e.connRef,setMyOffer:o,setMyAnswer:f})})}var hn=function(){var e=Object(a.useState)(!0),t=Object(u.a)(e,2),n=t[0],c=t[1],s=Object(a.useRef)(),o=Object(a.useRef)(),i=Object(a.useCallback)((function(){c(!1),bt(o.current)}),[o]);return Object(a.useEffect)((function(){s.current=function(){var e={pc:new RTCPeerConnection(l),dc:null,messageHandlers:{},messageHandlersIndx:"0"};return e.pc.ondatachannel=function(t){e.dc=t.channel,e.dc.onopen=function(){return d(e)},e.dc.onmessage=function(t){return f(e,t)}},e.pc.oniceconnectionstatechange=function(t){return console.log(e.pc.iceConnectionState)},e}(),o.current=Ze(s.current)}),[]),Object(a.useEffect)((function(){var e=p(s.current,(function(e){return function(e,t){console.log("game receiving message!"),console.log(t),"data"===t.type?(Object(Oe.a)(Je.includes(t.method)),console.log(qe),qe[t.method](e,t)):console.log("ignoring non-data message")}(o.current,e)}));return function(){_(s.current,e)}}),[s,o]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"zkmao"}),n&&Object(r.jsx)(bn,{connRef:s,startGame:i}),!n&&Object(r.jsx)(on,{connRef:s,gameRef:o})]})},jn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,259)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(hn,{})}),document.getElementById("root")),jn()}},[[258,1,2]]]);
//# sourceMappingURL=main.054f8bb6.chunk.js.map