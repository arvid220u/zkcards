(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{12:function(e,n,t){},21:function(e,n,t){},30:function(e,n){},31:function(e,n,t){"use strict";t.r(n);var r=t(0),c=t(1),a=t.n(c),s=t(13),o=t.n(s),u=(t(21),t(2)),i=(t(12),t(14)),f={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302"]}]},l=navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).catch(console.log);function d(e){console.log("opened chat!!"),console.log(e.messageHandlers);var n={type:"info",value:"successfully opened connection!!"};for(var t in e.messageHandlers)e.messageHandlers[t](n)}function j(e,n){console.log("received message!"),console.log(e.messageHandlers);var t=JSON.parse(n.data);for(var r in console.log(t),e.messageHandlers)e.messageHandlers[r](t)}function b(e,n){var t=e.messageHandlersIndx;return e.messageHandlers[t]=n,e.messageHandlersIndx="".concat(parseInt(t)+1),t}function g(e,n){console.log("removing key ".concat(n," from conn ").concat(e)),delete e.messageHandlers[n]}function O(e,n){e.dc.send(JSON.stringify(n))}function h(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function p(e){var n=e;return n.length%4!==0&&(n+="===".slice(0,4-n.length%4)),n=n.replace(/-/g,"+").replace(/_/g,"/"),atob(n)}var m=t(5),R=t.n(m),v=t(10),y=t(4),x=t(15),S=t.n(x);function A(e,n){for(var t,r,c=e.length;0!==c;)r=Math.floor(n()*c),t=e[c-=1],e[c]=e[r],e[r]=t;return e}var E,T=t(8),C="Q",N="K",P=["A","2","3","4","5","6","7","8","9","10","J",C,N],k=["spades","hearts","diamonds","clubs"];function w(e){return A(function(){var e,n=[],t=0,r=Object(T.a)(k);try{for(r.s();!(e=r.n()).done;){var c,a=e.value,s=0,o=Object(T.a)(P);try{for(o.s();!(c=o.n()).done;){var u=c.value;n.push({rank:u,suit:a,rank_index:s,suit_index:t}),s++}}catch(i){o.e(i)}finally{o.f()}t++}}catch(i){r.e(i)}finally{r.f()}return n}(),e)}function D(e){var n="\ud83c\udca1".charCodeAt(0),t="\ud83c\udca1".charCodeAt(1);return String.fromCharCode(n)+String.fromCharCode(t+e.rank_index+16*e.suit_index+(e.rank===C||e.rank===N?1:0))}function Y(e){var n,t="",r=Object(T.a)(e);try{for(r.s();!(n=r.n()).done;){t+=D(n.value)}}catch(c){r.e(c)}finally{r.f()}return t}function H(e,n){e||(console.error("assertion failed"),console.error(n))}var _={SETUP:"SETUP",PLAY:"PLAY",GAMEOVER:"GAMEOVER",ABORT:"ABORT"},M=(Object.values(_),{PRE_READY:"PRE_READY",SENT_READY:"SENT_READY",SENT_START:"SENT_START"}),I=(Object.values(M),{READY:"READY",START:"START",PLAY:"PLAY",PLAYACK:"PLAYACK",ABORT:"ABORT"}),L=Object.values(I),J=(E={},Object(y.a)(E,I.READY,(function(e,n){e.phase!==_.SETUP&&z(e);e.state!==M.PRE_READY&&e.state!==M.SENT_READY&&z(e);var t=n.from,r=n.hash;e.players.includes(t)&&z(e);e.players.push(t),e.readyHashes[t]=r,X(e),G(e)})),Object(y.a)(E,I.START,(function(e,n){return V.apply(this,arguments)})),Object(y.a)(E,I.PLAY,(function(e,n){K(),G(e)})),Object(y.a)(E,I.PLAYACK,(function(e,n){K(),G(e)})),Object(y.a)(E,I.ABORT,(function(e,n){console.log("ABORTING :(((( SAD"),K(),G(e)})),E);function U(e,n){var t=e.listenerIndex;return e.listeners[t]=n,e.listenerIndex="".concat(parseInt(t)+1),t}function B(e,n){console.log("removing key ".concat(n," from game ").concat(e)),delete e.listener[n]}function G(e){for(var n=0,t=Object.values(e.listeners);n<t.length;n++){(0,t[n])()}}function F(e,n){var t,r;n.from=e.userId,t=e.conn,r=n,O(t,Object(i.a)({type:"data"},r))}function K(){H(!1,"not implemented yet!!")}function V(){return(V=Object(v.a)(R.a.mark((function e(n,t){var r,c,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.phase!==_.SETUP&&z(n,"wrong phase"),n.state!==M.SENT_READY&&n.state!==M.SENT_START&&z(n),r=t.from,c=t.randomNumber,Object.keys(n.startNumbers).includes(r)&&z(n),n.players.includes(r)||z(n,"unknown user ".concat(r)),e.next=8,Q("".concat(c));case 8:a=e.sent,n.readyHashes[r]!==a&&z(n,"incorrect hash ".concat(a," received for random number ").concat(c," from user ").concat(r)),n.startNumbers[r]=c,q(n),G(n);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,n){console.error("ABORT GAME :(("),console.error(n),F(e,{method:I.ABORT,reason:n}),e.phase=_.ABORT,G(e)}function Q(e){return W.apply(this,arguments)}function W(){return(W=Object(v.a)(R.a.mark((function e(n){var t,r,c,a,s;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new TextEncoder,r=t.encode(n),e.next=4,crypto.subtle.digest("SHA-256",r);case 4:return c=e.sent,a=Array.from(new Uint8Array(c)),s=a.map((function(e){return e.toString(16).padStart(2,"0")})).join(""),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return($=Object(v.a)(R.a.mark((function e(n){var t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H(n.phase===_.SETUP&&n.state===M.PRE_READY||n.phase===_.GAMEOVER,n),n.myRandom=Math.floor(Math.random()*Math.pow(2,64)),e.next=4,Q("".concat(n.myRandom));case 4:t=e.sent,console.log(t),n.readyHashes[n.userId]=t,F(n,{method:I.READY,hash:t}),n.state=M.SENT_READY,X(n),G(n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){e.players.length===Object.keys(e.startNumbers).length&&function(e){H(e.phase===_.SETUP&&e.state===M.SENT_START,e);var n=0;Object.values(e.startNumbers).forEach((function(e){n^=e})),console.log("final randomness: ".concat(n));var t=S()("".concat(n));delete e.state,delete e.readyHashes,delete e.startNumbers,delete e.myRandom,e.players=A(e.players.sort(),t),e.nextTurn=e.players[0],e.playedCards=[],e.playerHands=function(e,n){var t,r=w(n),c={},a=0,s=Object(T.a)(e);try{for(s.s();!(t=s.n()).done;)c[t.value]=[]}catch(i){s.e(i)}finally{s.f()}for(;a<r.length;){var o,u=Object(T.a)(e);try{for(u.s();!(o=u.n()).done;)c[o.value].push(r[a]),a++}catch(i){u.e(i)}finally{u.f()}}return c}(A(e.players,t),t),e.phase=_.PLAY,console.log("STARTING GAME!!!! exciting :)))"),console.log(e),G(e)}(e)}function X(e){e.conn,1===Object.keys(e.readyHashes).length-1&&(H(e.players.length===Object.keys(e.readyHashes).length,e),function(e){H(e.phase===_.SETUP&&e.state===M.SENT_READY,e),F(e,{method:I.START,randomNumber:e.myRandom}),e.startNumbers[e.userId]=e.myRandom,e.state=M.SENT_START,q(e),G(e)}(e))}function Z(e){return e.userId}function ee(e){return e.players.filter((function(n){return n!==Z(e)}))[0]}function ne(e){return e.playerHands[Z(e)]}function te(e){return e.playerHands[ee(e)]}function re(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useState)(""),i=Object(u.a)(o,2),f=i[0],l=i[1];function d(){O(e.connRef.current,{type:"message",message:a}),j(a),s("")}function j(e){l((function(n){return""===n?e:e+"\n"+n}))}return Object(c.useEffect)((function(){var n=b(e.connRef.current,(function(e){if("message"===e.type)return j(e.message);j(JSON.stringify(e))}));return function(){console.log("cleaning up chat!!! index ".concat(n)),g(e.connRef.current,n)}}),[e.connRef]),Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){return"Enter"===e.key?d():0}}),Object(r.jsx)("button",{onClick:d,children:"Send message"}),Object(r.jsx)("p",{style:{whiteSpace:"pre-line"},children:f})]})}function ce(){return Object(r.jsx)("div",{children:"Waiting for everyone else to press start..."})}function ae(e){var n=Object(c.useState)(e.gameRef.current.playedCards),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useState)(ne(e.gameRef.current)),i=Object(u.a)(o,2),f=i[0],l=i[1],d=Object(c.useState)(te(e.gameRef.current)),j=Object(u.a)(d,2),b=j[0],g=j[1],O=Object(c.useState)(Z(e.gameRef.current)),h=Object(u.a)(O,2),p=h[0],m=h[1],R=Object(c.useState)(ee(e.gameRef.current)),v=Object(u.a)(R,2),y=v[0],x=v[1],S=Object(c.useCallback)((function(){s(e.gameRef.current.playedCards),l(ne(e.gameRef.current)),g(te(e.gameRef.current)),m(Z(e.gameRef.current)),x(ee(e.gameRef.current))}),[e.gameRef]);return Object(c.useEffect)((function(){var n=U(e.gameRef.current,S);return function(){B(e.gameRef.current,n)}}),[e.gameRef,S]),Object(r.jsxs)("div",{children:["Playing the game!!!",Object(r.jsx)("hr",{}),Object(r.jsx)(oe,{cards:b,user:y}),Object(r.jsx)(se,{cards:a}),Object(r.jsx)(oe,{cards:f,user:p})]})}function se(e){return Object(r.jsxs)("div",{children:["played cards: ",Object(r.jsx)(ue,{cards:e.cards})]})}function oe(e){return Object(r.jsxs)("div",{children:[e.user,"'s cards:",Object(r.jsx)(ue,{cards:e.cards})]})}function ue(e){return 0===e.cards.length?Object(r.jsx)("div",{children:"(none)"}):Object(r.jsx)("div",{style:{fontSize:"3em"},children:Y(e.cards)})}function ie(e){var n=Object(c.useState)(e.gameRef.current.phase),t=Object(u.a)(n,2),a=t[0],s=t[1],o=Object(c.useState)(Z(e.gameRef.current)),i=Object(u.a)(o,2),f=i[0],l=i[1],d=Object(c.useCallback)((function(){s(e.gameRef.current.phase),l(Z(e.gameRef.current))}),[e.gameRef]);return Object(c.useEffect)((function(){var n=U(e.gameRef.current,d);return function(){B(e.gameRef.current,n)}}),[e.gameRef,d]),Object(r.jsxs)("div",{children:["welcome to the game, ",f,"!",Object(r.jsx)("hr",{}),a===_.SETUP&&Object(r.jsx)(ce,{}),a===_.PLAY&&Object(r.jsx)(ae,{gameRef:e.gameRef}),Object(r.jsx)("hr",{}),Object(r.jsx)(re,{connRef:e.connRef})]})}function fe(e){return Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:function(){return n=e.connRef.current,t=e.setMyOffer,console.log("create offer"),console.log(n.pc.signalingState),n.dc=n.pc.createDataChannel("chat"),n.dc.onopen=function(){return d(n)},n.dc.onmessage=function(e){return j(n,e)},l.then((function(){return n.pc.createOffer()})).then((function(e){return n.pc.setLocalDescription(e)})).catch(console.log),void(n.pc.onicecandidate=function(e){e.candidate||t(h(JSON.stringify(n.pc.localDescription)))});var n,t},children:"Create game"})})}function le(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1];return Object(r.jsxs)("div",{children:["send this message to your friends: ",Object(r.jsx)("code",{children:e.offer}),Object(r.jsx)("br",{}),"input their answer:",Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)}}),Object(r.jsx)("button",{onClick:function(){return function(e,n){console.log("join"),console.log(e.pc.signalingState);var t=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(t).catch(console.log)}(e.connRef.current,a)},children:"Add player"})]})}function de(e){var n=Object(c.useState)(""),t=Object(u.a)(n,2),a=t[0],s=t[1];return Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{type:"text",value:a,onChange:function(e){return s(e.target.value)}}),Object(r.jsx)("button",{onClick:function(){return function(e,n,t){console.log("join"),console.log(e.pc.signalingState);var r=new RTCSessionDescription(JSON.parse(p(n)));e.pc.setRemoteDescription(r).then((function(){return e.pc.createAnswer()})).then((function(n){return e.pc.setLocalDescription(n)})).catch(console.log),e.pc.onicecandidate=function(n){n.candidate||t(h(JSON.stringify(e.pc.localDescription)))}}(e.connRef.current,a,e.setMyAnswer)},children:"Join"})]})}function je(e){return Object(r.jsxs)("div",{children:["send this message to your friends: ",Object(r.jsx)("code",{children:e.answer}),Object(r.jsx)("br",{})]})}function be(e){return console.log(e.connRef),Object(r.jsxs)("div",{children:[Object(r.jsx)(fe,{connRef:e.connRef,setMyOffer:e.setMyOffer}),Object(r.jsx)("br",{}),Object(r.jsx)(de,{connRef:e.connRef,setMyAnswer:e.setMyAnswer}),Object(r.jsx)("br",{})]})}function ge(e){return Object(r.jsxs)("div",{children:[e.offer?Object(r.jsx)(le,{connRef:e.connRef,offer:e.offer}):Object(r.jsx)(je,{connRef:e.connRef,answer:e.answer}),Object(r.jsx)("hr",{}),"Participants list: idk",Object(r.jsx)("br",{}),Object(r.jsx)("hr",{}),Object(r.jsx)("button",{onClick:e.startGame,children:"Start game!"}),Object(r.jsx)("hr",{}),Object(r.jsx)(re,{connRef:e.connRef})]})}function Oe(e){var n=Object(c.useState)(null),t=Object(u.a)(n,2),s=t[0],o=t[1],i=Object(c.useState)(null),f=Object(u.a)(i,2),l=f[0],d=f[1];return s||l?Object(r.jsx)(ge,{connRef:e.connRef,offer:s,answer:l,startGame:e.startGame}):Object(r.jsx)(a.a.Fragment,{children:Object(r.jsx)(be,{connRef:e.connRef,setMyOffer:o,setMyAnswer:d})})}H(JSON.stringify(L)===JSON.stringify(Object.keys(J)),{methods:L,handlers:J});var he=function(){var e=Object(c.useState)(!0),n=Object(u.a)(e,2),t=n[0],a=n[1],s=Object(c.useRef)(),o=Object(c.useRef)(),i=Object(c.useCallback)((function(){a(!1),function(e){$.apply(this,arguments)}(o.current)}),[o]);return Object(c.useEffect)((function(){s.current=function(){var e={pc:new RTCPeerConnection(f),dc:null,messageHandlers:{},messageHandlersIndx:"0"};return e.pc.ondatachannel=function(n){e.dc=n.channel,e.dc.onopen=function(){return d(e)},e.dc.onmessage=function(n){return j(e,n)}},e.pc.oniceconnectionstatechange=function(n){return console.log(e.pc.iceConnectionState)},e}(),o.current=function(e){var n=Math.random().toString(36).substr(2,9);return{conn:e,listeners:{},listenerIndex:"0",phase:_.SETUP,userId:n,state:M.PRE_READY,players:[n],readyHashes:{},startNumbers:{},myRandom:null}}(s.current)}),[]),Object(c.useEffect)((function(){var e=b(s.current,(function(e){return function(e,n){console.log("game receiving message!"),console.log(n),"data"===n.type?(H(L.includes(n.method)),console.log(J),J[n.method](e,n)):console.log("ignoring non-data message")}(o.current,e)}));return function(){g(s.current,e)}}),[s,o]),Object(r.jsxs)("div",{className:"App",children:[t&&Object(r.jsx)(Oe,{connRef:s,startGame:i}),!t&&Object(r.jsx)(ie,{connRef:s,gameRef:o})]})},pe=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,32)).then((function(n){var t=n.getCLS,r=n.getFID,c=n.getFCP,a=n.getLCP,s=n.getTTFB;t(e),r(e),c(e),a(e),s(e)}))};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(he,{})}),document.getElementById("root")),pe()}},[[31,1,2]]]);
//# sourceMappingURL=main.2d36e050.chunk.js.map